/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Component, Inject, HostListener } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { Observable } from 'rxjs/Observable';
import 'rxjs/add/observable/of';
import 'rxjs/add/operator/delay';
import { SpacerComponent } from '../spacer/spacer.component';
import { Library } from '../library.model';
import { LayoutEditor } from '../layout-editor.model';
import { BootstrapService } from '../bootstrap.service';
var PanelComponent = /** @class */ (function () {
    function PanelComponent(document, widgetsService, bootstrapService) {
        this.document = document;
        this.widgetsService = widgetsService;
        this.bootstrapService = bootstrapService;
        this.layoutEditor = new LayoutEditor();
        this.resizeGuidelines = [];
        this.isOverlayDisplayed = false;
    }
    /**
     * @return {?}
     */
    PanelComponent.prototype.onResize = /**
     * @return {?}
     */
    function () {
        if (this.bootstrapService.hasBreakpointChanged()) {
            this.addHorizontalSpacers();
        }
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.preventHighlightingWhileMoving = /**
     * @return {?}
     */
    function () {
        this.document.body.classList.add('no-highlighting');
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.allowHighlighting = /**
     * @return {?}
     */
    function () {
        this.document.body.classList.remove('no-highlighting');
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.createSpacer = /**
     * @return {?}
     */
    function () {
        return {
            spacer: {}
        };
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.clearSpacers = /**
     * @return {?}
     */
    function () {
        for (var /** @type {?} */ i = this.items.length - 1; i >= 0; i--) {
            if (this.items[i].spacer) {
                this.items.splice(i, 1);
            }
        }
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.addHorizontalSpacers = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.clearSpacers();
        var /** @type {?} */ usedWidthOnRow = 0;
        var /** @type {?} */ indexesToInsertSpacer = [0];
        for (var /** @type {?} */ i = 0; i < this.items.length; i++) {
            var /** @type {?} */ widget = this.items[i].widget || this.items[i].dropTarget;
            if (this.movingWidgetComponent && widget === this.movingWidgetComponent.widget) {
                continue;
            }
            var /** @type {?} */ widgetWidth = this.bootstrapService.getWidth(widget.getCurrentWidth.bind(widget));
            usedWidthOnRow += widgetWidth;
            if (usedWidthOnRow === this.bootstrapService.maxColumns) {
                indexesToInsertSpacer.push(i + 1);
                usedWidthOnRow = 0;
            }
            else if (usedWidthOnRow > this.bootstrapService.maxColumns) {
                indexesToInsertSpacer.push(i);
                usedWidthOnRow = widgetWidth;
            }
        }
        indexesToInsertSpacer
            .reverse()
            .forEach(function (x) {
            _this.items.splice(x, 0, _this.createSpacer());
        });
        if (!this.items[this.items.length - 1].spacer) {
            this.items.push(this.createSpacer());
        }
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.toggleOverlay = /**
     * @return {?}
     */
    function () {
        this.isOverlayDisplayed = !this.isOverlayDisplayed;
        if (this.isOverlayDisplayed) {
            document.getElementById('overlay').style.display = 'block';
        }
        else {
            document.getElementById('overlay').style.display = 'none';
        }
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var /** @type {?} */ renderedWidgets = this.widgetsService.getRenderedWidgets();
        this.items = renderedWidgets.map(function (x) {
            return { widget: x };
        });
        this.addHorizontalSpacers();
        var /** @type {?} */ availableWidgets = this.widgetsService.getAvailableWidgets();
        this.library = new Library(renderedWidgets, availableWidgets);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PanelComponent.prototype.onEditLibrary = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.library.edit(event.pageX, event.pageY);
        this.toggleOverlay();
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.onHideLibrary = /**
     * @return {?}
     */
    function () {
        this.library.hide();
        this.toggleOverlay();
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.clearExistingDropTarget = /**
     * @return {?}
     */
    function () {
        for (var /** @type {?} */ i = 0; i < this.items.length; i++) {
            if (this.items[i].dropTarget) {
                this.items.splice(i, 1);
            }
        }
    };
    /**
     * @param {?} movingWidget
     * @param {?} indexOfDrop
     * @return {?}
     */
    PanelComponent.prototype.isWidgetMovingDown = /**
     * @param {?} movingWidget
     * @param {?} indexOfDrop
     * @return {?}
     */
    function (movingWidget, indexOfDrop) {
        var /** @type {?} */ indexOfWidgetBeforeMove = this.items
            .map(function (x) { return x.widget; })
            .indexOf(movingWidget);
        return indexOfDrop > indexOfWidgetBeforeMove;
    };
    /**
     * @param {?} currentResident
     * @param {?} newResident
     * @return {?}
     */
    PanelComponent.prototype.insertDropTarget = /**
     * @param {?} currentResident
     * @param {?} newResident
     * @return {?}
     */
    function (currentResident, newResident) {
        if (!newResident) {
            newResident = currentResident;
        }
        this.clearExistingDropTarget();
        var /** @type {?} */ dropTarget = newResident.widget.clone();
        var /** @type {?} */ indexOfDrop;
        if (currentResident instanceof SpacerComponent) {
            this.bootstrapService.makeFullWidth(dropTarget.makeFullWidth.bind(dropTarget));
            indexOfDrop = this.items
                .map(function (x) { return x.spacer; })
                .indexOf(currentResident.spacer);
        }
        else {
            indexOfDrop = this.items
                .map(function (x) { return x.widget; })
                .indexOf(currentResident.widget);
            if (this.isWidgetMovingDown(newResident.widget, indexOfDrop)) {
                indexOfDrop++;
            }
        }
        var /** @type {?} */ height = newResident.getHeightInformation().height;
        this.items.splice(indexOfDrop, 0, { dropTarget: dropTarget, height: height });
    };
    /**
     * @param {?} widgetComponent
     * @return {?}
     */
    PanelComponent.prototype.onWidgetMove = /**
     * @param {?} widgetComponent
     * @return {?}
     */
    function (widgetComponent) {
        this.movingWidgetComponent = widgetComponent;
        this.preventHighlightingWhileMoving();
        this.insertDropTarget(widgetComponent, null);
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.onWidgetDropped = /**
     * @return {?}
     */
    function () {
        this.items.splice(this.items.map(function (x) { return x.widget; }).indexOf(this.movingWidgetComponent.widget), 1);
        for (var /** @type {?} */ i = 0; i < this.items.length; i++) {
            if (this.items[i].dropTarget) {
                this.items.splice(i, 1, { widget: this.movingWidgetComponent.widget });
                break;
            }
        }
        this.allowHighlighting();
        this.movingWidgetComponent = null;
        this.addHorizontalSpacers();
    };
    /**
     * @param {?} widgetComponent
     * @return {?}
     */
    PanelComponent.prototype.onWidgetHovered = /**
     * @param {?} widgetComponent
     * @return {?}
     */
    function (widgetComponent) {
        var _this = this;
        if (!this.movingWidgetComponent) {
            return;
        }
        console.log('test 0', new Date());
        this.moveHoverSubscription = Observable.of({})
            .delay(30)
            .subscribe(function () {
            console.log('test', new Date());
            if (!_this.movingWidgetComponent) {
                return;
            }
            _this.insertDropTarget(widgetComponent, _this.movingWidgetComponent);
            _this.addHorizontalSpacers();
        });
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.onWidgetUnhovered = /**
     * @return {?}
     */
    function () {
        if (this.moveHoverSubscription) {
            this.moveHoverSubscription.unsubscribe();
            this.moveHoverSubscription = null;
        }
    };
    /**
     * @param {?} spacerComponent
     * @return {?}
     */
    PanelComponent.prototype.onSpacerHovered = /**
     * @param {?} spacerComponent
     * @return {?}
     */
    function (spacerComponent) {
        var _this = this;
        if (!this.movingWidgetComponent) {
            return;
        }
        this.moveHoverSubscription = Observable.of({})
            .delay(300)
            .subscribe(function () {
            if (!_this.movingWidgetComponent) {
                return;
            }
            _this.insertDropTarget(spacerComponent, _this.movingWidgetComponent);
            _this.addHorizontalSpacers();
        });
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.onSpacerUnhovered = /**
     * @return {?}
     */
    function () {
        if (this.moveHoverSubscription) {
            this.moveHoverSubscription.unsubscribe();
            this.moveHoverSubscription = null;
        }
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.makeGrid = /**
     * @return {?}
     */
    function () {
        var /** @type {?} */ grid = [];
        grid.push([]);
        var /** @type {?} */ currentRowWidth = 0;
        var /** @type {?} */ widgets = this.items
            .filter(function (x) { return x.widget; })
            .map(function (x) { return x.widget; });
        for (var /** @type {?} */ i = 0; i < widgets.length; i++) {
            var /** @type {?} */ widget = widgets[i];
            var /** @type {?} */ width = this.bootstrapService
                .getWidth(widget.getCurrentWidth.bind(widget));
            grid[grid.length - 1].push(widget);
            currentRowWidth += width;
            var /** @type {?} */ isLastWidget = i === widgets.length - 1;
            if (isLastWidget) {
                break;
            }
            if (currentRowWidth === this.bootstrapService.maxColumns) {
                grid.push([]);
                currentRowWidth = 0;
            }
            else {
                // Preview the next widget and see if a new row is needed due to lack of space.
                var /** @type {?} */ nextWidget = widgets[i + 1];
                var /** @type {?} */ nextWidgetWidth = this.bootstrapService
                    .getWidth(nextWidget.getCurrentWidth.bind(nextWidget));
                var /** @type {?} */ spaceLeftOnCurrentRow = this.bootstrapService.maxColumns - currentRowWidth;
                if (nextWidgetWidth > spaceLeftOnCurrentRow) {
                    grid.push([]);
                    currentRowWidth = 0;
                }
            }
        }
        return grid;
    };
    ;
    /**
     * @param {?} widget
     * @return {?}
     */
    PanelComponent.prototype.findRowContainingWidget = /**
     * @param {?} widget
     * @return {?}
     */
    function (widget) {
        // I'm making a multi-dimensional array of the entire grid before trying to
        // find which row the widget is in. This is less efficient than building the
        // grid and simultaneously checking if the row has the widget, but it makes
        // the logic much more reasonable.
        var /** @type {?} */ grid = this.makeGrid();
        for (var /** @type {?} */ i = 0; i < grid.length; i++) {
            var /** @type {?} */ widgetIndex = grid[i].indexOf(widget);
            if (widgetIndex >= 0) {
                return grid[i];
            }
        }
    };
    ;
    /**
     * @param {?} widget
     * @return {?}
     */
    PanelComponent.prototype.calculateBoundaries = /**
     * @param {?} widget
     * @return {?}
     */
    function (widget) {
        var _this = this;
        var /** @type {?} */ row = this.findRowContainingWidget(widget);
        console.log("row", row);
        var /** @type {?} */ currentPosition = row
            .slice(0, row.indexOf(widget) + 1)
            .map(function (x) { return _this.bootstrapService.getWidth(x.getCurrentWidth.bind(x)); })
            .reduce(function (x, y) { return x + y; });
        var /** @type {?} */ minimumWidth = this.bootstrapService.getWidth(widget.getMinimumWidth.bind(widget));
        var /** @type {?} */ spaceToMinimize = this.bootstrapService.getWidth(widget.getCurrentWidth.bind(widget)) - minimumWidth;
        // Don't go left far enough to exceed the minimum of the widget.
        var /** @type {?} */ left = currentPosition - spaceToMinimize;
        // Don't go right far enough to exceed the width of the row.
        var /** @type {?} */ right = this.bootstrapService.maxColumns;
        // This is used to determine at which column to start drawing guidelines.
        var /** @type {?} */ offset = minimumWidth - left;
        return { left: left, right: right, offset: offset };
    };
    /**
     * @param {?} widgetComponent
     * @return {?}
     */
    PanelComponent.prototype.drawResizeGuidelines = /**
     * @param {?} widgetComponent
     * @return {?}
     */
    function (widgetComponent) {
        var /** @type {?} */ heightInformation = widgetComponent.getHeightInformation();
        var /** @type {?} */ boundaries = this.calculateBoundaries(widgetComponent.widget);
        for (var /** @type {?} */ i = boundaries.left; i <= boundaries.right; i++) {
            // unshift() which inserts at the beginning of the array instead of push()
            // because we want to display the longest guideline first so that the shorter
            // one is on top of the longer one. This will help when we hover over each one.
            // If the longer one was on top it would be the only guideline raising events.
            this.resizeGuidelines.unshift({
                widthOfGuideline: i,
                targetWidthOfWidget: i + boundaries.offset,
                top: heightInformation.top,
                height: heightInformation.height,
                widget: widgetComponent.widget
            });
        }
    };
    /**
     * @param {?} widget
     * @return {?}
     */
    PanelComponent.prototype.onWidgetResized = /**
     * @param {?} widget
     * @return {?}
     */
    function (widget) {
        var /** @type {?} */ indexOfWidget = this.items
            .map(function (x) { return x.widget; })
            .indexOf(widget);
        this.items.splice(indexOfWidget, 1, { widget: widget });
        this.addHorizontalSpacers();
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.endWidgetResize = /**
     * @return {?}
     */
    function () {
        this.resizeGuidelines = [];
        this.allowHighlighting();
        if (this.mouseUpSubscription) {
            this.mouseUpSubscription.unsubscribe();
        }
        if (this.touchEndSubscription) {
            this.touchEndSubscription.unsubscribe();
        }
    };
    /**
     * @param {?} widgetComponent
     * @return {?}
     */
    PanelComponent.prototype.onWidgetResizeStarted = /**
     * @param {?} widgetComponent
     * @return {?}
     */
    function (widgetComponent) {
        var _this = this;
        this.drawResizeGuidelines(widgetComponent);
        this.preventHighlightingWhileMoving();
        this.mouseUpSubscription =
            Observable.fromEvent(this.document, 'mouseup')
                .subscribe(function () {
                _this.endWidgetResize();
                if (_this.mouseUpSubscription) {
                    _this.mouseUpSubscription.unsubscribe();
                }
            });
        this.touchEndSubscription =
            Observable.fromEvent(this.document, 'touchend')
                .subscribe(function () {
                _this.endWidgetResize();
                if (_this.touchEndSubscription) {
                    _this.touchEndSubscription.unsubscribe();
                }
            });
    };
    /**
     * @param {?} widget
     * @return {?}
     */
    PanelComponent.prototype.onRenderWidget = /**
     * @param {?} widget
     * @return {?}
     */
    function (widget) {
        this.items.unshift({ widget: widget });
        this.addHorizontalSpacers();
    };
    /**
     * @param {?} widget
     * @return {?}
     */
    PanelComponent.prototype.onDerenderWidget = /**
     * @param {?} widget
     * @return {?}
     */
    function (widget) {
        var _this = this;
        this.items
            .filter(function (x) { return x.widget && x.widget.id === widget.id; })
            .forEach(function (x) {
            _this.items.splice(_this.items.indexOf(x), 1);
        });
        this.addHorizontalSpacers();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PanelComponent.prototype.onEditLayout = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.layoutEditor.edit(event.pageX, event.pageY);
        this.toggleOverlay();
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.onHideLayoutEditor = /**
     * @return {?}
     */
    function () {
        this.layoutEditor.hide();
        this.toggleOverlay();
    };
    /**
     * @param {?} widget
     * @return {?}
     */
    PanelComponent.prototype.onWidgetCloseClick = /**
     * @param {?} widget
     * @return {?}
     */
    function (widget) {
        var _this = this;
        this.items
            .filter(function (x) { return x.widget && x.widget === widget; })
            .forEach(function (x) {
            _this.items.splice(_this.items.indexOf(x), 1);
        });
        this.addHorizontalSpacers();
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.onWidgetToggleFullScreenClick = /**
     * @return {?}
     */
    function () {
        this.toggleOverlay();
    };
    /**
     * @return {?}
     */
    PanelComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.moveHoverSubscription) {
            this.moveHoverSubscription.unsubscribe();
        }
        if (this.mouseUpSubscription) {
            this.mouseUpSubscription.unsubscribe();
        }
        if (this.touchEndSubscription) {
            this.touchEndSubscription.unsubscribe();
        }
    };
    PanelComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-widgets-panel',
                    template: "<app-widgets-panel-controls (editLibrary)='onEditLibrary($event)' (editLayout)='onEditLayout($event)'></app-widgets-panel-controls>\n<app-widgets-library *ngIf='library.isDisplayed' [library]='library' (done)='onHideLibrary()' (renderWidget)='onRenderWidget($event)' (derenderWidget)='onDerenderWidget($event)'></app-widgets-library>\n<app-widgets-layout-editor *ngIf='layoutEditor.isDisplayed' [layoutEditor]='layoutEditor' (done)='onHideLayoutEditor()'></app-widgets-layout-editor>\n<ng-container *ngFor='let item of items'>\n  <app-widget *ngIf='item.widget; else drop' [widget]='item.widget' (widgetMoving)='onWidgetMove($event)' (widgetDropped)='onWidgetDropped()' (widgetHovered)='onWidgetHovered($event)' (widgetUnhovered)='onWidgetUnhovered()' (resizeStarted)='onWidgetResizeStarted($event)'\n    (close)='onWidgetCloseClick($event)' (fullscreen)='onWidgetToggleFullScreenClick()'></app-widget>\n  <ng-template #drop>\n    <app-widget-drop-target *ngIf='item.dropTarget; else spacer' [dropTarget]='item.dropTarget' [height]='item.height'></app-widget-drop-target>\n    <ng-template #spacer>\n      <app-widgets-panel-spacer [spacer]='item.spacer' (spacerHovered)='onSpacerHovered($event)' (spacerUnhovered)='onSpacerUnhovered()'></app-widgets-panel-spacer>\n    </ng-template>\n  </ng-template>\n</ng-container>\n<app-widget-resize-guideline *ngFor='let guideline of resizeGuidelines' [guideline]='guideline' (resized)='onWidgetResized($event)'></app-widget-resize-guideline>",
                    styles: [".moving-widget{position:absolute;pointer-events:none;z-index:100}"]
                },] },
    ];
    /** @nocollapse */
    PanelComponent.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] },] },
        { type: undefined, decorators: [{ type: Inject, args: ['widgetsService',] },] },
        { type: BootstrapService, },
    ]; };
    PanelComponent.propDecorators = {
        "onResize": [{ type: HostListener, args: ['window:resize',] },],
    };
    return PanelComponent;
}());
export { PanelComponent };
function PanelComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    PanelComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    PanelComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    PanelComponent.propDecorators;
    /** @type {?} */
    PanelComponent.prototype.library;
    /** @type {?} */
    PanelComponent.prototype.layoutEditor;
    /** @type {?} */
    PanelComponent.prototype.items;
    /** @type {?} */
    PanelComponent.prototype.resizeGuidelines;
    /** @type {?} */
    PanelComponent.prototype.moveHoverSubscription;
    /** @type {?} */
    PanelComponent.prototype.mouseUpSubscription;
    /** @type {?} */
    PanelComponent.prototype.touchEndSubscription;
    /** @type {?} */
    PanelComponent.prototype.isOverlayDisplayed;
    /** @type {?} */
    PanelComponent.prototype.movingWidgetComponent;
    /** @type {?} */
    PanelComponent.prototype.document;
    /** @type {?} */
    PanelComponent.prototype.widgetsService;
    /** @type {?} */
    PanelComponent.prototype.bootstrapService;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFuZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQG5hdmloZWFsdGgvd2lkZ2V0LWRhc2hib2FyZC1uZzUvIiwic291cmNlcyI6WyJzcmMvZGFzaGJvYXJkL3dpZGdldHMvcGFuZWwvcGFuZWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLE1BQU0sRUFBRSxZQUFZLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFDbkYsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM3QyxPQUFPLHdCQUF3QixDQUFDO0FBQ2hDLE9BQU8seUJBQXlCLENBQUM7QUFJakMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzdELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7O0lBeUN0RCx3QkFDNEIsVUFDUSxnQkFDMUI7UUFGa0IsYUFBUSxHQUFSLFFBQVE7UUFDQSxtQkFBYyxHQUFkLGNBQWM7UUFDeEMscUJBQWdCLEdBQWhCLGdCQUFnQjs0QkFyQlgsSUFBSSxZQUFZLEVBQUU7Z0NBRVAsRUFBRTtrQ0FPQyxLQUFLO0tBYWpDOzs7O0lBVjhCLGlDQUFROzs7O1FBQ3JDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNqRCxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztTQUM3Qjs7Ozs7SUFTSyx1REFBOEI7Ozs7UUFDcEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxpQkFB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QkFBcUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUMxQztRQUNELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUM7WUFDN0IsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQ3hDO1FBQ0QsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQztZQUM5QixJQUFJLENBQUMsb0JBQW9CLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDekM7S0FDRjs7Z0JBL1pGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsbUJBQW1CO29CQUM3QixRQUFRLEVBQUUsNjhDQWF1SjtvQkFDakssTUFBTSxFQUFFLENBQUMsbUVBQW1FLENBQUM7aUJBQzlFOzs7O2dEQXNCSSxNQUFNLFNBQUMsUUFBUTtnREFDZixNQUFNLFNBQUMsZ0JBQWdCO2dCQTNDbkIsZ0JBQWdCOzs7NkJBbUN0QixZQUFZLFNBQUMsZUFBZTs7eUJBOUMvQjs7U0FnQ2EsY0FBYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbmplY3QsIEhvc3RMaXN0ZW5lciwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcy9PYnNlcnZhYmxlJztcbmltcG9ydCAncnhqcy9hZGQvb2JzZXJ2YWJsZS9vZic7XG5pbXBvcnQgJ3J4anMvYWRkL29wZXJhdG9yL2RlbGF5JztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMvU3Vic2NyaXB0aW9uJztcbmltcG9ydCB7IFdpZGdldCB9IGZyb20gJy4uL3dpZGdldC5tb2RlbCc7XG5pbXBvcnQgeyBXaWRnZXRDb21wb25lbnQgfSBmcm9tICcuLi93aWRnZXQvd2lkZ2V0LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBTcGFjZXJDb21wb25lbnQgfSBmcm9tICcuLi9zcGFjZXIvc3BhY2VyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBMaWJyYXJ5IH0gZnJvbSAnLi4vbGlicmFyeS5tb2RlbCc7XG5pbXBvcnQgeyBMYXlvdXRFZGl0b3IgfSBmcm9tICcuLi9sYXlvdXQtZWRpdG9yLm1vZGVsJztcbmltcG9ydCB7IEJvb3RzdHJhcFNlcnZpY2UgfSBmcm9tICcuLi9ib290c3RyYXAuc2VydmljZSc7XG5pbXBvcnQgeyBJV2lkZ2V0c1NlcnZpY2UgfSBmcm9tICcuLi93aWRnZXRzLnNlcnZpY2UuaW50ZXJmYWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYXBwLXdpZGdldHMtcGFuZWwnLFxuICB0ZW1wbGF0ZTogYDxhcHAtd2lkZ2V0cy1wYW5lbC1jb250cm9scyAoZWRpdExpYnJhcnkpPSdvbkVkaXRMaWJyYXJ5KCRldmVudCknIChlZGl0TGF5b3V0KT0nb25FZGl0TGF5b3V0KCRldmVudCknPjwvYXBwLXdpZGdldHMtcGFuZWwtY29udHJvbHM+XHJcbjxhcHAtd2lkZ2V0cy1saWJyYXJ5ICpuZ0lmPSdsaWJyYXJ5LmlzRGlzcGxheWVkJyBbbGlicmFyeV09J2xpYnJhcnknIChkb25lKT0nb25IaWRlTGlicmFyeSgpJyAocmVuZGVyV2lkZ2V0KT0nb25SZW5kZXJXaWRnZXQoJGV2ZW50KScgKGRlcmVuZGVyV2lkZ2V0KT0nb25EZXJlbmRlcldpZGdldCgkZXZlbnQpJz48L2FwcC13aWRnZXRzLWxpYnJhcnk+XHJcbjxhcHAtd2lkZ2V0cy1sYXlvdXQtZWRpdG9yICpuZ0lmPSdsYXlvdXRFZGl0b3IuaXNEaXNwbGF5ZWQnIFtsYXlvdXRFZGl0b3JdPSdsYXlvdXRFZGl0b3InIChkb25lKT0nb25IaWRlTGF5b3V0RWRpdG9yKCknPjwvYXBwLXdpZGdldHMtbGF5b3V0LWVkaXRvcj5cclxuPG5nLWNvbnRhaW5lciAqbmdGb3I9J2xldCBpdGVtIG9mIGl0ZW1zJz5cclxuICA8YXBwLXdpZGdldCAqbmdJZj0naXRlbS53aWRnZXQ7IGVsc2UgZHJvcCcgW3dpZGdldF09J2l0ZW0ud2lkZ2V0JyAod2lkZ2V0TW92aW5nKT0nb25XaWRnZXRNb3ZlKCRldmVudCknICh3aWRnZXREcm9wcGVkKT0nb25XaWRnZXREcm9wcGVkKCknICh3aWRnZXRIb3ZlcmVkKT0nb25XaWRnZXRIb3ZlcmVkKCRldmVudCknICh3aWRnZXRVbmhvdmVyZWQpPSdvbldpZGdldFVuaG92ZXJlZCgpJyAocmVzaXplU3RhcnRlZCk9J29uV2lkZ2V0UmVzaXplU3RhcnRlZCgkZXZlbnQpJ1xyXG4gICAgKGNsb3NlKT0nb25XaWRnZXRDbG9zZUNsaWNrKCRldmVudCknIChmdWxsc2NyZWVuKT0nb25XaWRnZXRUb2dnbGVGdWxsU2NyZWVuQ2xpY2soKSc+PC9hcHAtd2lkZ2V0PlxyXG4gIDxuZy10ZW1wbGF0ZSAjZHJvcD5cclxuICAgIDxhcHAtd2lkZ2V0LWRyb3AtdGFyZ2V0ICpuZ0lmPSdpdGVtLmRyb3BUYXJnZXQ7IGVsc2Ugc3BhY2VyJyBbZHJvcFRhcmdldF09J2l0ZW0uZHJvcFRhcmdldCcgW2hlaWdodF09J2l0ZW0uaGVpZ2h0Jz48L2FwcC13aWRnZXQtZHJvcC10YXJnZXQ+XHJcbiAgICA8bmctdGVtcGxhdGUgI3NwYWNlcj5cclxuICAgICAgPGFwcC13aWRnZXRzLXBhbmVsLXNwYWNlciBbc3BhY2VyXT0naXRlbS5zcGFjZXInIChzcGFjZXJIb3ZlcmVkKT0nb25TcGFjZXJIb3ZlcmVkKCRldmVudCknIChzcGFjZXJVbmhvdmVyZWQpPSdvblNwYWNlclVuaG92ZXJlZCgpJz48L2FwcC13aWRnZXRzLXBhbmVsLXNwYWNlcj5cclxuICAgIDwvbmctdGVtcGxhdGU+XHJcbiAgPC9uZy10ZW1wbGF0ZT5cclxuPC9uZy1jb250YWluZXI+XHJcbjxhcHAtd2lkZ2V0LXJlc2l6ZS1ndWlkZWxpbmUgKm5nRm9yPSdsZXQgZ3VpZGVsaW5lIG9mIHJlc2l6ZUd1aWRlbGluZXMnIFtndWlkZWxpbmVdPSdndWlkZWxpbmUnIChyZXNpemVkKT0nb25XaWRnZXRSZXNpemVkKCRldmVudCknPjwvYXBwLXdpZGdldC1yZXNpemUtZ3VpZGVsaW5lPmAsXG4gIHN0eWxlczogW2AubW92aW5nLXdpZGdldHtwb3NpdGlvbjphYnNvbHV0ZTtwb2ludGVyLWV2ZW50czpub25lO3otaW5kZXg6MTAwfWBdXG59KVxuZXhwb3J0IGNsYXNzIFBhbmVsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBsaWJyYXJ5OiBMaWJyYXJ5O1xuICBsYXlvdXRFZGl0b3IgPSBuZXcgTGF5b3V0RWRpdG9yKCk7XG4gIGl0ZW1zOiBhbnlbXTtcbiAgcmVzaXplR3VpZGVsaW5lczogYW55W10gPSBbXTtcblxuICAvLyBBbGwgc3Vic2NyaXB0aW9ucyBtdXN0IGJlIGNsZWFuZWQgdXAgdG8gcHJldmVudCBsZWFrcy5cbiAgcHJpdmF0ZSBtb3ZlSG92ZXJTdWJzY3JpcHRpb246IGFueTtcbiAgcHJpdmF0ZSBtb3VzZVVwU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gIHByaXZhdGUgdG91Y2hFbmRTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcblxuICBwcml2YXRlIGlzT3ZlcmxheURpc3BsYXllZCA9IGZhbHNlO1xuICBwcml2YXRlIG1vdmluZ1dpZGdldENvbXBvbmVudDogV2lkZ2V0Q29tcG9uZW50O1xuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpyZXNpemUnKSBvblJlc2l6ZSgpIHtcbiAgICBpZiAodGhpcy5ib290c3RyYXBTZXJ2aWNlLmhhc0JyZWFrcG9pbnRDaGFuZ2VkKCkpIHtcbiAgICAgIHRoaXMuYWRkSG9yaXpvbnRhbFNwYWNlcnMoKTtcbiAgICB9XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIGRvY3VtZW50LFxuICAgIEBJbmplY3QoJ3dpZGdldHNTZXJ2aWNlJykgcHJpdmF0ZSB3aWRnZXRzU2VydmljZTogSVdpZGdldHNTZXJ2aWNlLFxuICAgIHByaXZhdGUgYm9vdHN0cmFwU2VydmljZTogQm9vdHN0cmFwU2VydmljZSkge1xuICB9XG5cbiAgcHJpdmF0ZSBwcmV2ZW50SGlnaGxpZ2h0aW5nV2hpbGVNb3ZpbmcoKTogdm9pZCB7XG4gICAgdGhpcy5kb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ25vLWhpZ2hsaWdodGluZycpO1xuICB9XG5cbiAgcHJpdmF0ZSBhbGxvd0hpZ2hsaWdodGluZygpOiB2b2lkIHtcbiAgICB0aGlzLmRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnbm8taGlnaGxpZ2h0aW5nJyk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVNwYWNlcigpOiBvYmplY3Qge1xuICAgIHJldHVybiB7XG4gICAgICBzcGFjZXI6IHt9XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgY2xlYXJTcGFjZXJzKCk6IHZvaWQge1xuICAgIGZvciAobGV0IGkgPSB0aGlzLml0ZW1zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBpZiAodGhpcy5pdGVtc1tpXS5zcGFjZXIpIHtcbiAgICAgICAgdGhpcy5pdGVtcy5zcGxpY2UoaSwgMSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhZGRIb3Jpem9udGFsU3BhY2VycygpOiB2b2lkIHtcbiAgICB0aGlzLmNsZWFyU3BhY2VycygpO1xuXG4gICAgbGV0IHVzZWRXaWR0aE9uUm93ID0gMDtcbiAgICBjb25zdCBpbmRleGVzVG9JbnNlcnRTcGFjZXIgPSBbMF07XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHdpZGdldCA9IHRoaXMuaXRlbXNbaV0ud2lkZ2V0IHx8IHRoaXMuaXRlbXNbaV0uZHJvcFRhcmdldDtcblxuICAgICAgaWYgKHRoaXMubW92aW5nV2lkZ2V0Q29tcG9uZW50ICYmIHdpZGdldCA9PT0gdGhpcy5tb3ZpbmdXaWRnZXRDb21wb25lbnQud2lkZ2V0KSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB3aWRnZXRXaWR0aCA9IHRoaXMuYm9vdHN0cmFwU2VydmljZS5nZXRXaWR0aCh3aWRnZXQuZ2V0Q3VycmVudFdpZHRoLmJpbmQod2lkZ2V0KSk7XG4gICAgICB1c2VkV2lkdGhPblJvdyArPSB3aWRnZXRXaWR0aDtcblxuICAgICAgaWYgKHVzZWRXaWR0aE9uUm93ID09PSB0aGlzLmJvb3RzdHJhcFNlcnZpY2UubWF4Q29sdW1ucykge1xuICAgICAgICBpbmRleGVzVG9JbnNlcnRTcGFjZXIucHVzaChpICsgMSk7XG4gICAgICAgIHVzZWRXaWR0aE9uUm93ID0gMDtcbiAgICAgIH0gZWxzZSBpZiAodXNlZFdpZHRoT25Sb3cgPiB0aGlzLmJvb3RzdHJhcFNlcnZpY2UubWF4Q29sdW1ucykge1xuICAgICAgICBpbmRleGVzVG9JbnNlcnRTcGFjZXIucHVzaChpKTtcbiAgICAgICAgdXNlZFdpZHRoT25Sb3cgPSB3aWRnZXRXaWR0aDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpbmRleGVzVG9JbnNlcnRTcGFjZXJcbiAgICAgIC5yZXZlcnNlKClcbiAgICAgIC5mb3JFYWNoKHggPT4ge1xuICAgICAgICB0aGlzLml0ZW1zLnNwbGljZSh4LCAwLCB0aGlzLmNyZWF0ZVNwYWNlcigpKTtcbiAgICAgIH0pO1xuXG4gICAgaWYgKCF0aGlzLml0ZW1zW3RoaXMuaXRlbXMubGVuZ3RoIC0gMV0uc3BhY2VyKSB7XG4gICAgICB0aGlzLml0ZW1zLnB1c2godGhpcy5jcmVhdGVTcGFjZXIoKSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB0b2dnbGVPdmVybGF5KCk6IHZvaWQge1xuICAgIHRoaXMuaXNPdmVybGF5RGlzcGxheWVkID0gIXRoaXMuaXNPdmVybGF5RGlzcGxheWVkO1xuXG4gICAgaWYgKHRoaXMuaXNPdmVybGF5RGlzcGxheWVkKSB7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3ZlcmxheScpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3ZlcmxheScpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgY29uc3QgcmVuZGVyZWRXaWRnZXRzID0gdGhpcy53aWRnZXRzU2VydmljZS5nZXRSZW5kZXJlZFdpZGdldHMoKTtcbiAgICB0aGlzLml0ZW1zID0gcmVuZGVyZWRXaWRnZXRzLm1hcCh4ID0+IHtcbiAgICAgIHJldHVybiB7IHdpZGdldDogeCB9O1xuICAgIH0pO1xuICAgIHRoaXMuYWRkSG9yaXpvbnRhbFNwYWNlcnMoKTtcbiAgICBjb25zdCBhdmFpbGFibGVXaWRnZXRzID0gdGhpcy53aWRnZXRzU2VydmljZS5nZXRBdmFpbGFibGVXaWRnZXRzKCk7XG4gICAgdGhpcy5saWJyYXJ5ID0gbmV3IExpYnJhcnkocmVuZGVyZWRXaWRnZXRzLCBhdmFpbGFibGVXaWRnZXRzKTtcbiAgfVxuXG4gIG9uRWRpdExpYnJhcnkoZXZlbnQ6IGFueSk6IHZvaWQge1xuICAgIHRoaXMubGlicmFyeS5lZGl0KGV2ZW50LnBhZ2VYLCBldmVudC5wYWdlWSk7XG4gICAgdGhpcy50b2dnbGVPdmVybGF5KCk7XG4gIH1cblxuICBvbkhpZGVMaWJyYXJ5KCk6IHZvaWQge1xuICAgIHRoaXMubGlicmFyeS5oaWRlKCk7XG4gICAgdGhpcy50b2dnbGVPdmVybGF5KCk7XG4gIH1cblxuICBwcml2YXRlIGNsZWFyRXhpc3RpbmdEcm9wVGFyZ2V0KCk6IHZvaWQge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHRoaXMuaXRlbXNbaV0uZHJvcFRhcmdldCkge1xuICAgICAgICB0aGlzLml0ZW1zLnNwbGljZShpLCAxKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGlzV2lkZ2V0TW92aW5nRG93bihtb3ZpbmdXaWRnZXQsIGluZGV4T2ZEcm9wKSB7XG4gICAgY29uc3QgaW5kZXhPZldpZGdldEJlZm9yZU1vdmUgPSB0aGlzLml0ZW1zXG4gICAgICAubWFwKHggPT4geC53aWRnZXQpXG4gICAgICAuaW5kZXhPZihtb3ZpbmdXaWRnZXQpO1xuICAgIHJldHVybiBpbmRleE9mRHJvcCA+IGluZGV4T2ZXaWRnZXRCZWZvcmVNb3ZlO1xuICB9XG5cbiAgcHJpdmF0ZSBpbnNlcnREcm9wVGFyZ2V0KGN1cnJlbnRSZXNpZGVudDogYW55LCBuZXdSZXNpZGVudDogV2lkZ2V0Q29tcG9uZW50KSB7XG4gICAgaWYgKCFuZXdSZXNpZGVudCkge1xuICAgICAgbmV3UmVzaWRlbnQgPSBjdXJyZW50UmVzaWRlbnQ7XG4gICAgfVxuICAgIHRoaXMuY2xlYXJFeGlzdGluZ0Ryb3BUYXJnZXQoKTtcbiAgICBjb25zdCBkcm9wVGFyZ2V0ID0gbmV3UmVzaWRlbnQud2lkZ2V0LmNsb25lKCk7XG4gICAgbGV0IGluZGV4T2ZEcm9wOiBudW1iZXI7XG5cbiAgICBpZiAoY3VycmVudFJlc2lkZW50IGluc3RhbmNlb2YgU3BhY2VyQ29tcG9uZW50KSB7XG4gICAgICB0aGlzLmJvb3RzdHJhcFNlcnZpY2UubWFrZUZ1bGxXaWR0aChkcm9wVGFyZ2V0Lm1ha2VGdWxsV2lkdGguYmluZChkcm9wVGFyZ2V0KSk7XG4gICAgICBpbmRleE9mRHJvcCA9IHRoaXMuaXRlbXNcbiAgICAgICAgLm1hcCh4ID0+IHguc3BhY2VyKVxuICAgICAgICAuaW5kZXhPZihjdXJyZW50UmVzaWRlbnQuc3BhY2VyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaW5kZXhPZkRyb3AgPSB0aGlzLml0ZW1zXG4gICAgICAgIC5tYXAoeCA9PiB4LndpZGdldClcbiAgICAgICAgLmluZGV4T2YoY3VycmVudFJlc2lkZW50LndpZGdldCk7XG4gICAgICBpZiAodGhpcy5pc1dpZGdldE1vdmluZ0Rvd24obmV3UmVzaWRlbnQud2lkZ2V0LCBpbmRleE9mRHJvcCkpIHtcbiAgICAgICAgaW5kZXhPZkRyb3ArKztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBoZWlnaHQgPSBuZXdSZXNpZGVudC5nZXRIZWlnaHRJbmZvcm1hdGlvbigpLmhlaWdodDtcbiAgICB0aGlzLml0ZW1zLnNwbGljZShpbmRleE9mRHJvcCwgMCwgeyBkcm9wVGFyZ2V0OiBkcm9wVGFyZ2V0LCBoZWlnaHQ6IGhlaWdodCB9KTtcbiAgfVxuXG4gIG9uV2lkZ2V0TW92ZSh3aWRnZXRDb21wb25lbnQ6IFdpZGdldENvbXBvbmVudCk6IHZvaWQge1xuICAgIHRoaXMubW92aW5nV2lkZ2V0Q29tcG9uZW50ID0gd2lkZ2V0Q29tcG9uZW50O1xuICAgIHRoaXMucHJldmVudEhpZ2hsaWdodGluZ1doaWxlTW92aW5nKCk7XG4gICAgdGhpcy5pbnNlcnREcm9wVGFyZ2V0KHdpZGdldENvbXBvbmVudCwgbnVsbCk7XG4gIH1cblxuICBvbldpZGdldERyb3BwZWQoKTogdm9pZCB7XG4gICAgdGhpcy5pdGVtcy5zcGxpY2UoXG4gICAgICB0aGlzLml0ZW1zLm1hcCh4ID0+IHgud2lkZ2V0KS5pbmRleE9mKHRoaXMubW92aW5nV2lkZ2V0Q29tcG9uZW50LndpZGdldCksXG4gICAgICAxKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh0aGlzLml0ZW1zW2ldLmRyb3BUYXJnZXQpIHtcbiAgICAgICAgdGhpcy5pdGVtcy5zcGxpY2UoaSwgMSwgeyB3aWRnZXQ6IHRoaXMubW92aW5nV2lkZ2V0Q29tcG9uZW50LndpZGdldCB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuYWxsb3dIaWdobGlnaHRpbmcoKTtcbiAgICB0aGlzLm1vdmluZ1dpZGdldENvbXBvbmVudCA9IG51bGw7XG4gICAgdGhpcy5hZGRIb3Jpem9udGFsU3BhY2VycygpO1xuICB9XG5cbiAgb25XaWRnZXRIb3ZlcmVkKHdpZGdldENvbXBvbmVudDogV2lkZ2V0Q29tcG9uZW50KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLm1vdmluZ1dpZGdldENvbXBvbmVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZygndGVzdCAwJywgbmV3IERhdGUoKSk7XG4gICAgdGhpcy5tb3ZlSG92ZXJTdWJzY3JpcHRpb24gPSBPYnNlcnZhYmxlLm9mKHt9KVxuICAgICAgLmRlbGF5KDMwKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCd0ZXN0JywgbmV3IERhdGUoKSk7XG4gICAgICAgIGlmICghdGhpcy5tb3ZpbmdXaWRnZXRDb21wb25lbnQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbnNlcnREcm9wVGFyZ2V0KHdpZGdldENvbXBvbmVudCwgdGhpcy5tb3ZpbmdXaWRnZXRDb21wb25lbnQpO1xuICAgICAgICB0aGlzLmFkZEhvcml6b250YWxTcGFjZXJzKCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIG9uV2lkZ2V0VW5ob3ZlcmVkKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLm1vdmVIb3ZlclN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5tb3ZlSG92ZXJTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMubW92ZUhvdmVyU3Vic2NyaXB0aW9uID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBvblNwYWNlckhvdmVyZWQoc3BhY2VyQ29tcG9uZW50OiBTcGFjZXJDb21wb25lbnQpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMubW92aW5nV2lkZ2V0Q29tcG9uZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMubW92ZUhvdmVyU3Vic2NyaXB0aW9uID0gT2JzZXJ2YWJsZS5vZih7fSlcbiAgICAgIC5kZWxheSgzMDApXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLm1vdmluZ1dpZGdldENvbXBvbmVudCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmluc2VydERyb3BUYXJnZXQoc3BhY2VyQ29tcG9uZW50LCB0aGlzLm1vdmluZ1dpZGdldENvbXBvbmVudCk7XG4gICAgICAgIHRoaXMuYWRkSG9yaXpvbnRhbFNwYWNlcnMoKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgb25TcGFjZXJVbmhvdmVyZWQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMubW92ZUhvdmVyU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLm1vdmVIb3ZlclN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy5tb3ZlSG92ZXJTdWJzY3JpcHRpb24gPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgbWFrZUdyaWQoKSB7XG4gICAgY29uc3QgZ3JpZCA9IFtdO1xuICAgIGdyaWQucHVzaChbXSk7XG4gICAgbGV0IGN1cnJlbnRSb3dXaWR0aCA9IDA7XG4gICAgY29uc3Qgd2lkZ2V0cyA9IHRoaXMuaXRlbXNcbiAgICAgIC5maWx0ZXIoeCA9PiB4LndpZGdldClcbiAgICAgIC5tYXAoeCA9PiB4LndpZGdldCk7XG4gIFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2lkZ2V0cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qgd2lkZ2V0ID0gd2lkZ2V0c1tpXTtcbiAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy5ib290c3RyYXBTZXJ2aWNlXG4gICAgICAgIC5nZXRXaWR0aCh3aWRnZXQuZ2V0Q3VycmVudFdpZHRoLmJpbmQod2lkZ2V0KSk7XG4gICAgICBncmlkW2dyaWQubGVuZ3RoIC0gMV0ucHVzaCh3aWRnZXQpO1xuICAgICAgY3VycmVudFJvd1dpZHRoICs9IHdpZHRoO1xuICAgICAgY29uc3QgaXNMYXN0V2lkZ2V0ID0gaSA9PT0gd2lkZ2V0cy5sZW5ndGggLSAxO1xuICAgICAgaWYgKGlzTGFzdFdpZGdldCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGlmIChjdXJyZW50Um93V2lkdGggPT09IHRoaXMuYm9vdHN0cmFwU2VydmljZS5tYXhDb2x1bW5zKSB7XG4gICAgICAgIGdyaWQucHVzaChbXSk7XG4gICAgICAgIGN1cnJlbnRSb3dXaWR0aCA9IDA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBQcmV2aWV3IHRoZSBuZXh0IHdpZGdldCBhbmQgc2VlIGlmIGEgbmV3IHJvdyBpcyBuZWVkZWQgZHVlIHRvIGxhY2sgb2Ygc3BhY2UuXG4gICAgICAgIGNvbnN0IG5leHRXaWRnZXQgPSB3aWRnZXRzW2kgKyAxXTtcbiAgICAgICAgY29uc3QgbmV4dFdpZGdldFdpZHRoID0gdGhpcy5ib290c3RyYXBTZXJ2aWNlXG4gICAgICAgICAgLmdldFdpZHRoKG5leHRXaWRnZXQuZ2V0Q3VycmVudFdpZHRoLmJpbmQobmV4dFdpZGdldCkpO1xuICAgICAgICBjb25zdCBzcGFjZUxlZnRPbkN1cnJlbnRSb3cgPSB0aGlzLmJvb3RzdHJhcFNlcnZpY2UubWF4Q29sdW1ucyAtIGN1cnJlbnRSb3dXaWR0aDtcbiAgICAgICAgaWYgKG5leHRXaWRnZXRXaWR0aCA+IHNwYWNlTGVmdE9uQ3VycmVudFJvdykge1xuICAgICAgICAgIGdyaWQucHVzaChbXSk7XG4gICAgICAgICAgY3VycmVudFJvd1dpZHRoID0gMDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgXG4gICAgcmV0dXJuIGdyaWQ7XG4gIH07XG5cbiAgcHJpdmF0ZSBmaW5kUm93Q29udGFpbmluZ1dpZGdldCh3aWRnZXQ6IFdpZGdldCk6IFdpZGdldFtdIHtcbiAgICAvLyBJJ20gbWFraW5nIGEgbXVsdGktZGltZW5zaW9uYWwgYXJyYXkgb2YgdGhlIGVudGlyZSBncmlkIGJlZm9yZSB0cnlpbmcgdG9cbiAgICAvLyBmaW5kIHdoaWNoIHJvdyB0aGUgd2lkZ2V0IGlzIGluLiBUaGlzIGlzIGxlc3MgZWZmaWNpZW50IHRoYW4gYnVpbGRpbmcgdGhlXG4gICAgLy8gZ3JpZCBhbmQgc2ltdWx0YW5lb3VzbHkgY2hlY2tpbmcgaWYgdGhlIHJvdyBoYXMgdGhlIHdpZGdldCwgYnV0IGl0IG1ha2VzXG4gICAgLy8gdGhlIGxvZ2ljIG11Y2ggbW9yZSByZWFzb25hYmxlLlxuICAgIGNvbnN0IGdyaWQgPSB0aGlzLm1ha2VHcmlkKCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBncmlkLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCB3aWRnZXRJbmRleCA9IGdyaWRbaV0uaW5kZXhPZih3aWRnZXQpO1xuICAgICAgaWYgKHdpZGdldEluZGV4ID49IDApIHtcbiAgICAgICAgcmV0dXJuIGdyaWRbaV07XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHByaXZhdGUgY2FsY3VsYXRlQm91bmRhcmllcyh3aWRnZXQ6IFdpZGdldCk6IG9iamVjdCB7XG4gICAgY29uc3Qgcm93ID0gdGhpcy5maW5kUm93Q29udGFpbmluZ1dpZGdldCh3aWRnZXQpO1xuICAgIGNvbnNvbGUubG9nKFwicm93XCIsIHJvdyk7XG4gICAgY29uc3QgY3VycmVudFBvc2l0aW9uID0gcm93XG4gICAgICAuc2xpY2UoMCwgcm93LmluZGV4T2Yod2lkZ2V0KSArIDEpXG4gICAgICAubWFwKHggPT4gdGhpcy5ib290c3RyYXBTZXJ2aWNlLmdldFdpZHRoKHguZ2V0Q3VycmVudFdpZHRoLmJpbmQoeCkpKVxuICAgICAgLnJlZHVjZSgoeCwgeSkgPT4geCArIHkpO1xuICAgIGNvbnN0IG1pbmltdW1XaWR0aCA9IHRoaXMuYm9vdHN0cmFwU2VydmljZS5nZXRXaWR0aCh3aWRnZXQuZ2V0TWluaW11bVdpZHRoLmJpbmQod2lkZ2V0KSk7XG4gICAgY29uc3Qgc3BhY2VUb01pbmltaXplID0gdGhpcy5ib290c3RyYXBTZXJ2aWNlLmdldFdpZHRoKHdpZGdldC5nZXRDdXJyZW50V2lkdGguYmluZCh3aWRnZXQpKSAtIG1pbmltdW1XaWR0aDtcbiAgICBcbiAgICAvLyBEb24ndCBnbyBsZWZ0IGZhciBlbm91Z2ggdG8gZXhjZWVkIHRoZSBtaW5pbXVtIG9mIHRoZSB3aWRnZXQuXG4gICAgY29uc3QgbGVmdCA9IGN1cnJlbnRQb3NpdGlvbiAtIHNwYWNlVG9NaW5pbWl6ZTtcbiAgICAvLyBEb24ndCBnbyByaWdodCBmYXIgZW5vdWdoIHRvIGV4Y2VlZCB0aGUgd2lkdGggb2YgdGhlIHJvdy5cbiAgICBjb25zdCByaWdodCA9IHRoaXMuYm9vdHN0cmFwU2VydmljZS5tYXhDb2x1bW5zO1xuICAgIC8vIFRoaXMgaXMgdXNlZCB0byBkZXRlcm1pbmUgYXQgd2hpY2ggY29sdW1uIHRvIHN0YXJ0IGRyYXdpbmcgZ3VpZGVsaW5lcy5cbiAgICBjb25zdCBvZmZzZXQgPSBtaW5pbXVtV2lkdGggLSBsZWZ0O1xuICAgIHJldHVybiB7IGxlZnQsIHJpZ2h0LCBvZmZzZXQgfTtcbiAgfVxuXG4gIHByaXZhdGUgZHJhd1Jlc2l6ZUd1aWRlbGluZXMod2lkZ2V0Q29tcG9uZW50OiBXaWRnZXRDb21wb25lbnQpOiB2b2lkIHtcbiAgICBjb25zdCBoZWlnaHRJbmZvcm1hdGlvbiA9IHdpZGdldENvbXBvbmVudC5nZXRIZWlnaHRJbmZvcm1hdGlvbigpO1xuICAgIGNvbnN0IGJvdW5kYXJpZXM6IGFueSA9IHRoaXMuY2FsY3VsYXRlQm91bmRhcmllcyh3aWRnZXRDb21wb25lbnQud2lkZ2V0KTtcbiAgICBmb3IgKGxldCBpID0gYm91bmRhcmllcy5sZWZ0OyBpIDw9IGJvdW5kYXJpZXMucmlnaHQ7IGkrKykge1xuICAgICAgLy8gdW5zaGlmdCgpIHdoaWNoIGluc2VydHMgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgYXJyYXkgaW5zdGVhZCBvZiBwdXNoKClcbiAgICAgIC8vIGJlY2F1c2Ugd2Ugd2FudCB0byBkaXNwbGF5IHRoZSBsb25nZXN0IGd1aWRlbGluZSBmaXJzdCBzbyB0aGF0IHRoZSBzaG9ydGVyXG4gICAgICAvLyBvbmUgaXMgb24gdG9wIG9mIHRoZSBsb25nZXIgb25lLiBUaGlzIHdpbGwgaGVscCB3aGVuIHdlIGhvdmVyIG92ZXIgZWFjaCBvbmUuXG4gICAgICAvLyBJZiB0aGUgbG9uZ2VyIG9uZSB3YXMgb24gdG9wIGl0IHdvdWxkIGJlIHRoZSBvbmx5IGd1aWRlbGluZSByYWlzaW5nIGV2ZW50cy5cbiAgICAgIHRoaXMucmVzaXplR3VpZGVsaW5lcy51bnNoaWZ0KHtcbiAgICAgICAgd2lkdGhPZkd1aWRlbGluZTogaSxcbiAgICAgICAgdGFyZ2V0V2lkdGhPZldpZGdldDogaSArIGJvdW5kYXJpZXMub2Zmc2V0LFxuICAgICAgICB0b3A6IGhlaWdodEluZm9ybWF0aW9uLnRvcCxcbiAgICAgICAgaGVpZ2h0OiBoZWlnaHRJbmZvcm1hdGlvbi5oZWlnaHQsXG4gICAgICAgIHdpZGdldDogd2lkZ2V0Q29tcG9uZW50LndpZGdldFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgb25XaWRnZXRSZXNpemVkKHdpZGdldDogV2lkZ2V0KTogdm9pZCB7XG4gICAgY29uc3QgaW5kZXhPZldpZGdldCA9IHRoaXMuaXRlbXNcbiAgICAgIC5tYXAoeCA9PiB4LndpZGdldClcbiAgICAgIC5pbmRleE9mKHdpZGdldCk7XG4gICAgdGhpcy5pdGVtcy5zcGxpY2UoaW5kZXhPZldpZGdldCwgMSwgeyB3aWRnZXQgfSk7XG4gICAgdGhpcy5hZGRIb3Jpem9udGFsU3BhY2VycygpO1xuICB9XG5cbiAgcHJpdmF0ZSBlbmRXaWRnZXRSZXNpemUoKSB7XG4gICAgdGhpcy5yZXNpemVHdWlkZWxpbmVzID0gW107XG4gICAgdGhpcy5hbGxvd0hpZ2hsaWdodGluZygpO1xuICAgIGlmICh0aGlzLm1vdXNlVXBTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMubW91c2VVcFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgICBpZiAodGhpcy50b3VjaEVuZFN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy50b3VjaEVuZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxuXG4gIG9uV2lkZ2V0UmVzaXplU3RhcnRlZCh3aWRnZXRDb21wb25lbnQpOiB2b2lkIHtcbiAgICB0aGlzLmRyYXdSZXNpemVHdWlkZWxpbmVzKHdpZGdldENvbXBvbmVudCk7XG4gICAgdGhpcy5wcmV2ZW50SGlnaGxpZ2h0aW5nV2hpbGVNb3ZpbmcoKTtcbiAgICB0aGlzLm1vdXNlVXBTdWJzY3JpcHRpb24gPVxuICAgICAgT2JzZXJ2YWJsZS5mcm9tRXZlbnQodGhpcy5kb2N1bWVudCwgJ21vdXNldXAnKVxuICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICB0aGlzLmVuZFdpZGdldFJlc2l6ZSgpO1xuICAgICAgICAgIGlmICh0aGlzLm1vdXNlVXBTdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHRoaXMubW91c2VVcFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgdGhpcy50b3VjaEVuZFN1YnNjcmlwdGlvbiA9XG4gICAgICBPYnNlcnZhYmxlLmZyb21FdmVudCh0aGlzLmRvY3VtZW50LCAndG91Y2hlbmQnKVxuICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICB0aGlzLmVuZFdpZGdldFJlc2l6ZSgpO1xuICAgICAgICAgIGlmICh0aGlzLnRvdWNoRW5kU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnRvdWNoRW5kU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgfVxuXG4gIG9uUmVuZGVyV2lkZ2V0KHdpZGdldDogV2lkZ2V0KSB7XG4gICAgdGhpcy5pdGVtcy51bnNoaWZ0KHsgd2lkZ2V0IH0pO1xuICAgIHRoaXMuYWRkSG9yaXpvbnRhbFNwYWNlcnMoKTtcbiAgfVxuXG4gIG9uRGVyZW5kZXJXaWRnZXQod2lkZ2V0OiBXaWRnZXQpIHtcbiAgICB0aGlzLml0ZW1zXG4gICAgICAuZmlsdGVyKHggPT4geC53aWRnZXQgJiYgeC53aWRnZXQuaWQgPT09IHdpZGdldC5pZClcbiAgICAgIC5mb3JFYWNoKHggPT4ge1xuICAgICAgICB0aGlzLml0ZW1zLnNwbGljZSh0aGlzLml0ZW1zLmluZGV4T2YoeCksIDEpO1xuICAgICAgfSk7XG4gICAgdGhpcy5hZGRIb3Jpem9udGFsU3BhY2VycygpO1xuICB9XG5cbiAgb25FZGl0TGF5b3V0KGV2ZW50KSB7XG4gICAgdGhpcy5sYXlvdXRFZGl0b3IuZWRpdChldmVudC5wYWdlWCwgZXZlbnQucGFnZVkpO1xuICAgIHRoaXMudG9nZ2xlT3ZlcmxheSgpO1xuICB9XG5cbiAgb25IaWRlTGF5b3V0RWRpdG9yKCkge1xuICAgIHRoaXMubGF5b3V0RWRpdG9yLmhpZGUoKTtcbiAgICB0aGlzLnRvZ2dsZU92ZXJsYXkoKTtcbiAgfVxuXG4gIG9uV2lkZ2V0Q2xvc2VDbGljayh3aWRnZXQpIHtcbiAgICB0aGlzLml0ZW1zXG4gICAgICAuZmlsdGVyKHggPT4geC53aWRnZXQgJiYgeC53aWRnZXQgPT09IHdpZGdldClcbiAgICAgIC5mb3JFYWNoKHggPT4ge1xuICAgICAgICB0aGlzLml0ZW1zLnNwbGljZSh0aGlzLml0ZW1zLmluZGV4T2YoeCksIDEpO1xuICAgICAgfSk7XG4gICAgdGhpcy5hZGRIb3Jpem9udGFsU3BhY2VycygpO1xuICB9XG5cbiAgb25XaWRnZXRUb2dnbGVGdWxsU2NyZWVuQ2xpY2soKSB7XG4gICAgdGhpcy50b2dnbGVPdmVybGF5KCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5tb3ZlSG92ZXJTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMubW92ZUhvdmVyU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLm1vdXNlVXBTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMubW91c2VVcFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgICBpZiAodGhpcy50b3VjaEVuZFN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy50b3VjaEVuZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxufVxuIl19