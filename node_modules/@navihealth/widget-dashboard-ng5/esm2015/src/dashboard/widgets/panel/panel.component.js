/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Component, Inject, HostListener } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { Observable } from 'rxjs/Observable';
import 'rxjs/add/observable/of';
import 'rxjs/add/operator/delay';
import { SpacerComponent } from '../spacer/spacer.component';
import { Library } from '../library.model';
import { LayoutEditor } from '../layout-editor.model';
import { BootstrapService } from '../bootstrap.service';
export class PanelComponent {
    /**
     * @param {?} document
     * @param {?} widgetsService
     * @param {?} bootstrapService
     */
    constructor(document, widgetsService, bootstrapService) {
        this.document = document;
        this.widgetsService = widgetsService;
        this.bootstrapService = bootstrapService;
        this.layoutEditor = new LayoutEditor();
        this.resizeGuidelines = [];
        this.isOverlayDisplayed = false;
    }
    /**
     * @return {?}
     */
    onResize() {
        if (this.bootstrapService.hasBreakpointChanged()) {
            this.addHorizontalSpacers();
        }
    }
    /**
     * @return {?}
     */
    preventHighlightingWhileMoving() {
        this.document.body.classList.add('no-highlighting');
    }
    /**
     * @return {?}
     */
    allowHighlighting() {
        this.document.body.classList.remove('no-highlighting');
    }
    /**
     * @return {?}
     */
    createSpacer() {
        return {
            spacer: {}
        };
    }
    /**
     * @return {?}
     */
    clearSpacers() {
        for (let /** @type {?} */ i = this.items.length - 1; i >= 0; i--) {
            if (this.items[i].spacer) {
                this.items.splice(i, 1);
            }
        }
    }
    /**
     * @return {?}
     */
    addHorizontalSpacers() {
        this.clearSpacers();
        let /** @type {?} */ usedWidthOnRow = 0;
        const /** @type {?} */ indexesToInsertSpacer = [0];
        for (let /** @type {?} */ i = 0; i < this.items.length; i++) {
            const /** @type {?} */ widget = this.items[i].widget || this.items[i].dropTarget;
            if (this.movingWidgetComponent && widget === this.movingWidgetComponent.widget) {
                continue;
            }
            const /** @type {?} */ widgetWidth = this.bootstrapService.getWidth(widget.getCurrentWidth.bind(widget));
            usedWidthOnRow += widgetWidth;
            if (usedWidthOnRow === this.bootstrapService.maxColumns) {
                indexesToInsertSpacer.push(i + 1);
                usedWidthOnRow = 0;
            }
            else if (usedWidthOnRow > this.bootstrapService.maxColumns) {
                indexesToInsertSpacer.push(i);
                usedWidthOnRow = widgetWidth;
            }
        }
        indexesToInsertSpacer
            .reverse()
            .forEach(x => {
            this.items.splice(x, 0, this.createSpacer());
        });
        if (!this.items[this.items.length - 1].spacer) {
            this.items.push(this.createSpacer());
        }
    }
    /**
     * @return {?}
     */
    toggleOverlay() {
        this.isOverlayDisplayed = !this.isOverlayDisplayed;
        if (this.isOverlayDisplayed) {
            document.getElementById('overlay').style.display = 'block';
        }
        else {
            document.getElementById('overlay').style.display = 'none';
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        const /** @type {?} */ renderedWidgets = this.widgetsService.getRenderedWidgets();
        this.items = renderedWidgets.map(x => {
            return { widget: x };
        });
        this.addHorizontalSpacers();
        const /** @type {?} */ availableWidgets = this.widgetsService.getAvailableWidgets();
        this.library = new Library(renderedWidgets, availableWidgets);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onEditLibrary(event) {
        this.library.edit(event.pageX, event.pageY);
        this.toggleOverlay();
    }
    /**
     * @return {?}
     */
    onHideLibrary() {
        this.library.hide();
        this.toggleOverlay();
    }
    /**
     * @return {?}
     */
    clearExistingDropTarget() {
        for (let /** @type {?} */ i = 0; i < this.items.length; i++) {
            if (this.items[i].dropTarget) {
                this.items.splice(i, 1);
            }
        }
    }
    /**
     * @param {?} movingWidget
     * @param {?} indexOfDrop
     * @return {?}
     */
    isWidgetMovingDown(movingWidget, indexOfDrop) {
        const /** @type {?} */ indexOfWidgetBeforeMove = this.items
            .map(x => x.widget)
            .indexOf(movingWidget);
        return indexOfDrop > indexOfWidgetBeforeMove;
    }
    /**
     * @param {?} currentResident
     * @param {?} newResident
     * @return {?}
     */
    insertDropTarget(currentResident, newResident) {
        if (!newResident) {
            newResident = currentResident;
        }
        this.clearExistingDropTarget();
        const /** @type {?} */ dropTarget = newResident.widget.clone();
        let /** @type {?} */ indexOfDrop;
        if (currentResident instanceof SpacerComponent) {
            this.bootstrapService.makeFullWidth(dropTarget.makeFullWidth.bind(dropTarget));
            indexOfDrop = this.items
                .map(x => x.spacer)
                .indexOf(currentResident.spacer);
        }
        else {
            indexOfDrop = this.items
                .map(x => x.widget)
                .indexOf(currentResident.widget);
            if (this.isWidgetMovingDown(newResident.widget, indexOfDrop)) {
                indexOfDrop++;
            }
        }
        const /** @type {?} */ height = newResident.getHeightInformation().height;
        this.items.splice(indexOfDrop, 0, { dropTarget: dropTarget, height: height });
    }
    /**
     * @param {?} widgetComponent
     * @return {?}
     */
    onWidgetMove(widgetComponent) {
        this.movingWidgetComponent = widgetComponent;
        this.preventHighlightingWhileMoving();
        this.insertDropTarget(widgetComponent, null);
    }
    /**
     * @return {?}
     */
    onWidgetDropped() {
        this.items.splice(this.items.map(x => x.widget).indexOf(this.movingWidgetComponent.widget), 1);
        for (let /** @type {?} */ i = 0; i < this.items.length; i++) {
            if (this.items[i].dropTarget) {
                this.items.splice(i, 1, { widget: this.movingWidgetComponent.widget });
                break;
            }
        }
        this.allowHighlighting();
        this.movingWidgetComponent = null;
        this.addHorizontalSpacers();
    }
    /**
     * @param {?} widgetComponent
     * @return {?}
     */
    onWidgetHovered(widgetComponent) {
        if (!this.movingWidgetComponent) {
            return;
        }
        console.log('test 0', new Date());
        this.moveHoverSubscription = Observable.of({})
            .delay(30)
            .subscribe(() => {
            console.log('test', new Date());
            if (!this.movingWidgetComponent) {
                return;
            }
            this.insertDropTarget(widgetComponent, this.movingWidgetComponent);
            this.addHorizontalSpacers();
        });
    }
    /**
     * @return {?}
     */
    onWidgetUnhovered() {
        if (this.moveHoverSubscription) {
            this.moveHoverSubscription.unsubscribe();
            this.moveHoverSubscription = null;
        }
    }
    /**
     * @param {?} spacerComponent
     * @return {?}
     */
    onSpacerHovered(spacerComponent) {
        if (!this.movingWidgetComponent) {
            return;
        }
        this.moveHoverSubscription = Observable.of({})
            .delay(300)
            .subscribe(() => {
            if (!this.movingWidgetComponent) {
                return;
            }
            this.insertDropTarget(spacerComponent, this.movingWidgetComponent);
            this.addHorizontalSpacers();
        });
    }
    /**
     * @return {?}
     */
    onSpacerUnhovered() {
        if (this.moveHoverSubscription) {
            this.moveHoverSubscription.unsubscribe();
            this.moveHoverSubscription = null;
        }
    }
    /**
     * @return {?}
     */
    makeGrid() {
        const /** @type {?} */ grid = [];
        grid.push([]);
        let /** @type {?} */ currentRowWidth = 0;
        const /** @type {?} */ widgets = this.items
            .filter(x => x.widget)
            .map(x => x.widget);
        for (let /** @type {?} */ i = 0; i < widgets.length; i++) {
            const /** @type {?} */ widget = widgets[i];
            const /** @type {?} */ width = this.bootstrapService
                .getWidth(widget.getCurrentWidth.bind(widget));
            grid[grid.length - 1].push(widget);
            currentRowWidth += width;
            const /** @type {?} */ isLastWidget = i === widgets.length - 1;
            if (isLastWidget) {
                break;
            }
            if (currentRowWidth === this.bootstrapService.maxColumns) {
                grid.push([]);
                currentRowWidth = 0;
            }
            else {
                // Preview the next widget and see if a new row is needed due to lack of space.
                const /** @type {?} */ nextWidget = widgets[i + 1];
                const /** @type {?} */ nextWidgetWidth = this.bootstrapService
                    .getWidth(nextWidget.getCurrentWidth.bind(nextWidget));
                const /** @type {?} */ spaceLeftOnCurrentRow = this.bootstrapService.maxColumns - currentRowWidth;
                if (nextWidgetWidth > spaceLeftOnCurrentRow) {
                    grid.push([]);
                    currentRowWidth = 0;
                }
            }
        }
        return grid;
    }
    ;
    /**
     * @param {?} widget
     * @return {?}
     */
    findRowContainingWidget(widget) {
        // I'm making a multi-dimensional array of the entire grid before trying to
        // find which row the widget is in. This is less efficient than building the
        // grid and simultaneously checking if the row has the widget, but it makes
        // the logic much more reasonable.
        const /** @type {?} */ grid = this.makeGrid();
        for (let /** @type {?} */ i = 0; i < grid.length; i++) {
            const /** @type {?} */ widgetIndex = grid[i].indexOf(widget);
            if (widgetIndex >= 0) {
                return grid[i];
            }
        }
    }
    ;
    /**
     * @param {?} widget
     * @return {?}
     */
    calculateBoundaries(widget) {
        const /** @type {?} */ row = this.findRowContainingWidget(widget);
        console.log("row", row);
        const /** @type {?} */ currentPosition = row
            .slice(0, row.indexOf(widget) + 1)
            .map(x => this.bootstrapService.getWidth(x.getCurrentWidth.bind(x)))
            .reduce((x, y) => x + y);
        const /** @type {?} */ minimumWidth = this.bootstrapService.getWidth(widget.getMinimumWidth.bind(widget));
        const /** @type {?} */ spaceToMinimize = this.bootstrapService.getWidth(widget.getCurrentWidth.bind(widget)) - minimumWidth;
        // Don't go left far enough to exceed the minimum of the widget.
        const /** @type {?} */ left = currentPosition - spaceToMinimize;
        // Don't go right far enough to exceed the width of the row.
        const /** @type {?} */ right = this.bootstrapService.maxColumns;
        // This is used to determine at which column to start drawing guidelines.
        const /** @type {?} */ offset = minimumWidth - left;
        return { left, right, offset };
    }
    /**
     * @param {?} widgetComponent
     * @return {?}
     */
    drawResizeGuidelines(widgetComponent) {
        const /** @type {?} */ heightInformation = widgetComponent.getHeightInformation();
        const /** @type {?} */ boundaries = this.calculateBoundaries(widgetComponent.widget);
        for (let /** @type {?} */ i = boundaries.left; i <= boundaries.right; i++) {
            // unshift() which inserts at the beginning of the array instead of push()
            // because we want to display the longest guideline first so that the shorter
            // one is on top of the longer one. This will help when we hover over each one.
            // If the longer one was on top it would be the only guideline raising events.
            this.resizeGuidelines.unshift({
                widthOfGuideline: i,
                targetWidthOfWidget: i + boundaries.offset,
                top: heightInformation.top,
                height: heightInformation.height,
                widget: widgetComponent.widget
            });
        }
    }
    /**
     * @param {?} widget
     * @return {?}
     */
    onWidgetResized(widget) {
        const /** @type {?} */ indexOfWidget = this.items
            .map(x => x.widget)
            .indexOf(widget);
        this.items.splice(indexOfWidget, 1, { widget });
        this.addHorizontalSpacers();
    }
    /**
     * @return {?}
     */
    endWidgetResize() {
        this.resizeGuidelines = [];
        this.allowHighlighting();
        if (this.mouseUpSubscription) {
            this.mouseUpSubscription.unsubscribe();
        }
        if (this.touchEndSubscription) {
            this.touchEndSubscription.unsubscribe();
        }
    }
    /**
     * @param {?} widgetComponent
     * @return {?}
     */
    onWidgetResizeStarted(widgetComponent) {
        this.drawResizeGuidelines(widgetComponent);
        this.preventHighlightingWhileMoving();
        this.mouseUpSubscription =
            Observable.fromEvent(this.document, 'mouseup')
                .subscribe(() => {
                this.endWidgetResize();
                if (this.mouseUpSubscription) {
                    this.mouseUpSubscription.unsubscribe();
                }
            });
        this.touchEndSubscription =
            Observable.fromEvent(this.document, 'touchend')
                .subscribe(() => {
                this.endWidgetResize();
                if (this.touchEndSubscription) {
                    this.touchEndSubscription.unsubscribe();
                }
            });
    }
    /**
     * @param {?} widget
     * @return {?}
     */
    onRenderWidget(widget) {
        this.items.unshift({ widget });
        this.addHorizontalSpacers();
    }
    /**
     * @param {?} widget
     * @return {?}
     */
    onDerenderWidget(widget) {
        this.items
            .filter(x => x.widget && x.widget.id === widget.id)
            .forEach(x => {
            this.items.splice(this.items.indexOf(x), 1);
        });
        this.addHorizontalSpacers();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onEditLayout(event) {
        this.layoutEditor.edit(event.pageX, event.pageY);
        this.toggleOverlay();
    }
    /**
     * @return {?}
     */
    onHideLayoutEditor() {
        this.layoutEditor.hide();
        this.toggleOverlay();
    }
    /**
     * @param {?} widget
     * @return {?}
     */
    onWidgetCloseClick(widget) {
        this.items
            .filter(x => x.widget && x.widget === widget)
            .forEach(x => {
            this.items.splice(this.items.indexOf(x), 1);
        });
        this.addHorizontalSpacers();
    }
    /**
     * @return {?}
     */
    onWidgetToggleFullScreenClick() {
        this.toggleOverlay();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.moveHoverSubscription) {
            this.moveHoverSubscription.unsubscribe();
        }
        if (this.mouseUpSubscription) {
            this.mouseUpSubscription.unsubscribe();
        }
        if (this.touchEndSubscription) {
            this.touchEndSubscription.unsubscribe();
        }
    }
}
PanelComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-widgets-panel',
                template: `<app-widgets-panel-controls (editLibrary)='onEditLibrary($event)' (editLayout)='onEditLayout($event)'></app-widgets-panel-controls>
<app-widgets-library *ngIf='library.isDisplayed' [library]='library' (done)='onHideLibrary()' (renderWidget)='onRenderWidget($event)' (derenderWidget)='onDerenderWidget($event)'></app-widgets-library>
<app-widgets-layout-editor *ngIf='layoutEditor.isDisplayed' [layoutEditor]='layoutEditor' (done)='onHideLayoutEditor()'></app-widgets-layout-editor>
<ng-container *ngFor='let item of items'>
  <app-widget *ngIf='item.widget; else drop' [widget]='item.widget' (widgetMoving)='onWidgetMove($event)' (widgetDropped)='onWidgetDropped()' (widgetHovered)='onWidgetHovered($event)' (widgetUnhovered)='onWidgetUnhovered()' (resizeStarted)='onWidgetResizeStarted($event)'
    (close)='onWidgetCloseClick($event)' (fullscreen)='onWidgetToggleFullScreenClick()'></app-widget>
  <ng-template #drop>
    <app-widget-drop-target *ngIf='item.dropTarget; else spacer' [dropTarget]='item.dropTarget' [height]='item.height'></app-widget-drop-target>
    <ng-template #spacer>
      <app-widgets-panel-spacer [spacer]='item.spacer' (spacerHovered)='onSpacerHovered($event)' (spacerUnhovered)='onSpacerUnhovered()'></app-widgets-panel-spacer>
    </ng-template>
  </ng-template>
</ng-container>
<app-widget-resize-guideline *ngFor='let guideline of resizeGuidelines' [guideline]='guideline' (resized)='onWidgetResized($event)'></app-widget-resize-guideline>`,
                styles: [`.moving-widget{position:absolute;pointer-events:none;z-index:100}`]
            },] },
];
/** @nocollapse */
PanelComponent.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] },] },
    { type: undefined, decorators: [{ type: Inject, args: ['widgetsService',] },] },
    { type: BootstrapService, },
];
PanelComponent.propDecorators = {
    "onResize": [{ type: HostListener, args: ['window:resize',] },],
};
function PanelComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    PanelComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    PanelComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    PanelComponent.propDecorators;
    /** @type {?} */
    PanelComponent.prototype.library;
    /** @type {?} */
    PanelComponent.prototype.layoutEditor;
    /** @type {?} */
    PanelComponent.prototype.items;
    /** @type {?} */
    PanelComponent.prototype.resizeGuidelines;
    /** @type {?} */
    PanelComponent.prototype.moveHoverSubscription;
    /** @type {?} */
    PanelComponent.prototype.mouseUpSubscription;
    /** @type {?} */
    PanelComponent.prototype.touchEndSubscription;
    /** @type {?} */
    PanelComponent.prototype.isOverlayDisplayed;
    /** @type {?} */
    PanelComponent.prototype.movingWidgetComponent;
    /** @type {?} */
    PanelComponent.prototype.document;
    /** @type {?} */
    PanelComponent.prototype.widgetsService;
    /** @type {?} */
    PanelComponent.prototype.bootstrapService;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFuZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQG5hdmloZWFsdGgvd2lkZ2V0LWRhc2hib2FyZC1uZzUvIiwic291cmNlcyI6WyJzcmMvZGFzaGJvYXJkL3dpZGdldHMvcGFuZWwvcGFuZWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLE1BQU0sRUFBRSxZQUFZLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFDbkYsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM3QyxPQUFPLHdCQUF3QixDQUFDO0FBQ2hDLE9BQU8seUJBQXlCLENBQUM7QUFJakMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzdELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFxQnhELE1BQU07Ozs7OztJQW9CSixZQUM0QixVQUNRLGdCQUMxQjtRQUZrQixhQUFRLEdBQVIsUUFBUTtRQUNBLG1CQUFjLEdBQWQsY0FBYztRQUN4QyxxQkFBZ0IsR0FBaEIsZ0JBQWdCOzRCQXJCWCxJQUFJLFlBQVksRUFBRTtnQ0FFUCxFQUFFO2tDQU9DLEtBQUs7S0FhakM7Ozs7SUFWOEIsUUFBUTtRQUNyQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDakQsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7U0FDN0I7Ozs7O0lBU0ssOEJBQThCO1FBQ3BDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENB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LENBQUMsbUVBQW1FLENBQUM7YUFDOUU7Ozs7NENBc0JJLE1BQU0sU0FBQyxRQUFROzRDQUNmLE1BQU0sU0FBQyxnQkFBZ0I7WUEzQ25CLGdCQUFnQjs7O3lCQW1DdEIsWUFBWSxTQUFDLGVBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5qZWN0LCBIb3N0TGlzdGVuZXIsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMvT2JzZXJ2YWJsZSc7XG5pbXBvcnQgJ3J4anMvYWRkL29ic2VydmFibGUvb2YnO1xuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9kZWxheSc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzL1N1YnNjcmlwdGlvbic7XG5pbXBvcnQgeyBXaWRnZXQgfSBmcm9tICcuLi93aWRnZXQubW9kZWwnO1xuaW1wb3J0IHsgV2lkZ2V0Q29tcG9uZW50IH0gZnJvbSAnLi4vd2lkZ2V0L3dpZGdldC5jb21wb25lbnQnO1xuaW1wb3J0IHsgU3BhY2VyQ29tcG9uZW50IH0gZnJvbSAnLi4vc3BhY2VyL3NwYWNlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgTGlicmFyeSB9IGZyb20gJy4uL2xpYnJhcnkubW9kZWwnO1xuaW1wb3J0IHsgTGF5b3V0RWRpdG9yIH0gZnJvbSAnLi4vbGF5b3V0LWVkaXRvci5tb2RlbCc7XG5pbXBvcnQgeyBCb290c3RyYXBTZXJ2aWNlIH0gZnJvbSAnLi4vYm9vdHN0cmFwLnNlcnZpY2UnO1xuaW1wb3J0IHsgSVdpZGdldHNTZXJ2aWNlIH0gZnJvbSAnLi4vd2lkZ2V0cy5zZXJ2aWNlLmludGVyZmFjZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2FwcC13aWRnZXRzLXBhbmVsJyxcbiAgdGVtcGxhdGU6IGA8YXBwLXdpZGdldHMtcGFuZWwtY29udHJvbHMgKGVkaXRMaWJyYXJ5KT0nb25FZGl0TGlicmFyeSgkZXZlbnQpJyAoZWRpdExheW91dCk9J29uRWRpdExheW91dCgkZXZlbnQpJz48L2FwcC13aWRnZXRzLXBhbmVsLWNvbnRyb2xzPlxyXG48YXBwLXdpZGdldHMtbGlicmFyeSAqbmdJZj0nbGlicmFyeS5pc0Rpc3BsYXllZCcgW2xpYnJhcnldPSdsaWJyYXJ5JyAoZG9uZSk9J29uSGlkZUxpYnJhcnkoKScgKHJlbmRlcldpZGdldCk9J29uUmVuZGVyV2lkZ2V0KCRldmVudCknIChkZXJlbmRlcldpZGdldCk9J29uRGVyZW5kZXJXaWRnZXQoJGV2ZW50KSc+PC9hcHAtd2lkZ2V0cy1saWJyYXJ5PlxyXG48YXBwLXdpZGdldHMtbGF5b3V0LWVkaXRvciAqbmdJZj0nbGF5b3V0RWRpdG9yLmlzRGlzcGxheWVkJyBbbGF5b3V0RWRpdG9yXT0nbGF5b3V0RWRpdG9yJyAoZG9uZSk9J29uSGlkZUxheW91dEVkaXRvcigpJz48L2FwcC13aWRnZXRzLWxheW91dC1lZGl0b3I+XHJcbjxuZy1jb250YWluZXIgKm5nRm9yPSdsZXQgaXRlbSBvZiBpdGVtcyc+XHJcbiAgPGFwcC13aWRnZXQgKm5nSWY9J2l0ZW0ud2lkZ2V0OyBlbHNlIGRyb3AnIFt3aWRnZXRdPSdpdGVtLndpZGdldCcgKHdpZGdldE1vdmluZyk9J29uV2lkZ2V0TW92ZSgkZXZlbnQpJyAod2lkZ2V0RHJvcHBlZCk9J29uV2lkZ2V0RHJvcHBlZCgpJyAod2lkZ2V0SG92ZXJlZCk9J29uV2lkZ2V0SG92ZXJlZCgkZXZlbnQpJyAod2lkZ2V0VW5ob3ZlcmVkKT0nb25XaWRnZXRVbmhvdmVyZWQoKScgKHJlc2l6ZVN0YXJ0ZWQpPSdvbldpZGdldFJlc2l6ZVN0YXJ0ZWQoJGV2ZW50KSdcclxuICAgIChjbG9zZSk9J29uV2lkZ2V0Q2xvc2VDbGljaygkZXZlbnQpJyAoZnVsbHNjcmVlbik9J29uV2lkZ2V0VG9nZ2xlRnVsbFNjcmVlbkNsaWNrKCknPjwvYXBwLXdpZGdldD5cclxuICA8bmctdGVtcGxhdGUgI2Ryb3A+XHJcbiAgICA8YXBwLXdpZGdldC1kcm9wLXRhcmdldCAqbmdJZj0naXRlbS5kcm9wVGFyZ2V0OyBlbHNlIHNwYWNlcicgW2Ryb3BUYXJnZXRdPSdpdGVtLmRyb3BUYXJnZXQnIFtoZWlnaHRdPSdpdGVtLmhlaWdodCc+PC9hcHAtd2lkZ2V0LWRyb3AtdGFyZ2V0PlxyXG4gICAgPG5nLXRlbXBsYXRlICNzcGFjZXI+XHJcbiAgICAgIDxhcHAtd2lkZ2V0cy1wYW5lbC1zcGFjZXIgW3NwYWNlcl09J2l0ZW0uc3BhY2VyJyAoc3BhY2VySG92ZXJlZCk9J29uU3BhY2VySG92ZXJlZCgkZXZlbnQpJyAoc3BhY2VyVW5ob3ZlcmVkKT0nb25TcGFjZXJVbmhvdmVyZWQoKSc+PC9hcHAtd2lkZ2V0cy1wYW5lbC1zcGFjZXI+XHJcbiAgICA8L25nLXRlbXBsYXRlPlxyXG4gIDwvbmctdGVtcGxhdGU+XHJcbjwvbmctY29udGFpbmVyPlxyXG48YXBwLXdpZGdldC1yZXNpemUtZ3VpZGVsaW5lICpuZ0Zvcj0nbGV0IGd1aWRlbGluZSBvZiByZXNpemVHdWlkZWxpbmVzJyBbZ3VpZGVsaW5lXT0nZ3VpZGVsaW5lJyAocmVzaXplZCk9J29uV2lkZ2V0UmVzaXplZCgkZXZlbnQpJz48L2FwcC13aWRnZXQtcmVzaXplLWd1aWRlbGluZT5gLFxuICBzdHlsZXM6IFtgLm1vdmluZy13aWRnZXR7cG9zaXRpb246YWJzb2x1dGU7cG9pbnRlci1ldmVudHM6bm9uZTt6LWluZGV4OjEwMH1gXVxufSlcbmV4cG9ydCBjbGFzcyBQYW5lbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgbGlicmFyeTogTGlicmFyeTtcbiAgbGF5b3V0RWRpdG9yID0gbmV3IExheW91dEVkaXRvcigpO1xuICBpdGVtczogYW55W107XG4gIHJlc2l6ZUd1aWRlbGluZXM6IGFueVtdID0gW107XG5cbiAgLy8gQWxsIHN1YnNjcmlwdGlvbnMgbXVzdCBiZSBjbGVhbmVkIHVwIHRvIHByZXZlbnQgbGVha3MuXG4gIHByaXZhdGUgbW92ZUhvdmVyU3Vic2NyaXB0aW9uOiBhbnk7XG4gIHByaXZhdGUgbW91c2VVcFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICBwcml2YXRlIHRvdWNoRW5kU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cbiAgcHJpdmF0ZSBpc092ZXJsYXlEaXNwbGF5ZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBtb3ZpbmdXaWRnZXRDb21wb25lbnQ6IFdpZGdldENvbXBvbmVudDtcblxuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6cmVzaXplJykgb25SZXNpemUoKSB7XG4gICAgaWYgKHRoaXMuYm9vdHN0cmFwU2VydmljZS5oYXNCcmVha3BvaW50Q2hhbmdlZCgpKSB7XG4gICAgICB0aGlzLmFkZEhvcml6b250YWxTcGFjZXJzKCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2N1bWVudCxcbiAgICBASW5qZWN0KCd3aWRnZXRzU2VydmljZScpIHByaXZhdGUgd2lkZ2V0c1NlcnZpY2U6IElXaWRnZXRzU2VydmljZSxcbiAgICBwcml2YXRlIGJvb3RzdHJhcFNlcnZpY2U6IEJvb3RzdHJhcFNlcnZpY2UpIHtcbiAgfVxuXG4gIHByaXZhdGUgcHJldmVudEhpZ2hsaWdodGluZ1doaWxlTW92aW5nKCk6IHZvaWQge1xuICAgIHRoaXMuZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCduby1oaWdobGlnaHRpbmcnKTtcbiAgfVxuXG4gIHByaXZhdGUgYWxsb3dIaWdobGlnaHRpbmcoKTogdm9pZCB7XG4gICAgdGhpcy5kb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ25vLWhpZ2hsaWdodGluZycpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVTcGFjZXIoKTogb2JqZWN0IHtcbiAgICByZXR1cm4ge1xuICAgICAgc3BhY2VyOiB7fVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGNsZWFyU3BhY2VycygpOiB2b2lkIHtcbiAgICBmb3IgKGxldCBpID0gdGhpcy5pdGVtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgaWYgKHRoaXMuaXRlbXNbaV0uc3BhY2VyKSB7XG4gICAgICAgIHRoaXMuaXRlbXMuc3BsaWNlKGksIDEpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWRkSG9yaXpvbnRhbFNwYWNlcnMoKTogdm9pZCB7XG4gICAgdGhpcy5jbGVhclNwYWNlcnMoKTtcblxuICAgIGxldCB1c2VkV2lkdGhPblJvdyA9IDA7XG4gICAgY29uc3QgaW5kZXhlc1RvSW5zZXJ0U3BhY2VyID0gWzBdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLml0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCB3aWRnZXQgPSB0aGlzLml0ZW1zW2ldLndpZGdldCB8fCB0aGlzLml0ZW1zW2ldLmRyb3BUYXJnZXQ7XG5cbiAgICAgIGlmICh0aGlzLm1vdmluZ1dpZGdldENvbXBvbmVudCAmJiB3aWRnZXQgPT09IHRoaXMubW92aW5nV2lkZ2V0Q29tcG9uZW50LndpZGdldCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgd2lkZ2V0V2lkdGggPSB0aGlzLmJvb3RzdHJhcFNlcnZpY2UuZ2V0V2lkdGgod2lkZ2V0LmdldEN1cnJlbnRXaWR0aC5iaW5kKHdpZGdldCkpO1xuICAgICAgdXNlZFdpZHRoT25Sb3cgKz0gd2lkZ2V0V2lkdGg7XG5cbiAgICAgIGlmICh1c2VkV2lkdGhPblJvdyA9PT0gdGhpcy5ib290c3RyYXBTZXJ2aWNlLm1heENvbHVtbnMpIHtcbiAgICAgICAgaW5kZXhlc1RvSW5zZXJ0U3BhY2VyLnB1c2goaSArIDEpO1xuICAgICAgICB1c2VkV2lkdGhPblJvdyA9IDA7XG4gICAgICB9IGVsc2UgaWYgKHVzZWRXaWR0aE9uUm93ID4gdGhpcy5ib290c3RyYXBTZXJ2aWNlLm1heENvbHVtbnMpIHtcbiAgICAgICAgaW5kZXhlc1RvSW5zZXJ0U3BhY2VyLnB1c2goaSk7XG4gICAgICAgIHVzZWRXaWR0aE9uUm93ID0gd2lkZ2V0V2lkdGg7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaW5kZXhlc1RvSW5zZXJ0U3BhY2VyXG4gICAgICAucmV2ZXJzZSgpXG4gICAgICAuZm9yRWFjaCh4ID0+IHtcbiAgICAgICAgdGhpcy5pdGVtcy5zcGxpY2UoeCwgMCwgdGhpcy5jcmVhdGVTcGFjZXIoKSk7XG4gICAgICB9KTtcblxuICAgIGlmICghdGhpcy5pdGVtc1t0aGlzLml0ZW1zLmxlbmd0aCAtIDFdLnNwYWNlcikge1xuICAgICAgdGhpcy5pdGVtcy5wdXNoKHRoaXMuY3JlYXRlU3BhY2VyKCkpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdG9nZ2xlT3ZlcmxheSgpOiB2b2lkIHtcbiAgICB0aGlzLmlzT3ZlcmxheURpc3BsYXllZCA9ICF0aGlzLmlzT3ZlcmxheURpc3BsYXllZDtcblxuICAgIGlmICh0aGlzLmlzT3ZlcmxheURpc3BsYXllZCkge1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ292ZXJsYXknKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICB9IGVsc2Uge1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ292ZXJsYXknKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIH1cbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIGNvbnN0IHJlbmRlcmVkV2lkZ2V0cyA9IHRoaXMud2lkZ2V0c1NlcnZpY2UuZ2V0UmVuZGVyZWRXaWRnZXRzKCk7XG4gICAgdGhpcy5pdGVtcyA9IHJlbmRlcmVkV2lkZ2V0cy5tYXAoeCA9PiB7XG4gICAgICByZXR1cm4geyB3aWRnZXQ6IHggfTtcbiAgICB9KTtcbiAgICB0aGlzLmFkZEhvcml6b250YWxTcGFjZXJzKCk7XG4gICAgY29uc3QgYXZhaWxhYmxlV2lkZ2V0cyA9IHRoaXMud2lkZ2V0c1NlcnZpY2UuZ2V0QXZhaWxhYmxlV2lkZ2V0cygpO1xuICAgIHRoaXMubGlicmFyeSA9IG5ldyBMaWJyYXJ5KHJlbmRlcmVkV2lkZ2V0cywgYXZhaWxhYmxlV2lkZ2V0cyk7XG4gIH1cblxuICBvbkVkaXRMaWJyYXJ5KGV2ZW50OiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLmxpYnJhcnkuZWRpdChldmVudC5wYWdlWCwgZXZlbnQucGFnZVkpO1xuICAgIHRoaXMudG9nZ2xlT3ZlcmxheSgpO1xuICB9XG5cbiAgb25IaWRlTGlicmFyeSgpOiB2b2lkIHtcbiAgICB0aGlzLmxpYnJhcnkuaGlkZSgpO1xuICAgIHRoaXMudG9nZ2xlT3ZlcmxheSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjbGVhckV4aXN0aW5nRHJvcFRhcmdldCgpOiB2b2lkIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh0aGlzLml0ZW1zW2ldLmRyb3BUYXJnZXQpIHtcbiAgICAgICAgdGhpcy5pdGVtcy5zcGxpY2UoaSwgMSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpc1dpZGdldE1vdmluZ0Rvd24obW92aW5nV2lkZ2V0LCBpbmRleE9mRHJvcCkge1xuICAgIGNvbnN0IGluZGV4T2ZXaWRnZXRCZWZvcmVNb3ZlID0gdGhpcy5pdGVtc1xuICAgICAgLm1hcCh4ID0+IHgud2lkZ2V0KVxuICAgICAgLmluZGV4T2YobW92aW5nV2lkZ2V0KTtcbiAgICByZXR1cm4gaW5kZXhPZkRyb3AgPiBpbmRleE9mV2lkZ2V0QmVmb3JlTW92ZTtcbiAgfVxuXG4gIHByaXZhdGUgaW5zZXJ0RHJvcFRhcmdldChjdXJyZW50UmVzaWRlbnQ6IGFueSwgbmV3UmVzaWRlbnQ6IFdpZGdldENvbXBvbmVudCkge1xuICAgIGlmICghbmV3UmVzaWRlbnQpIHtcbiAgICAgIG5ld1Jlc2lkZW50ID0gY3VycmVudFJlc2lkZW50O1xuICAgIH1cbiAgICB0aGlzLmNsZWFyRXhpc3RpbmdEcm9wVGFyZ2V0KCk7XG4gICAgY29uc3QgZHJvcFRhcmdldCA9IG5ld1Jlc2lkZW50LndpZGdldC5jbG9uZSgpO1xuICAgIGxldCBpbmRleE9mRHJvcDogbnVtYmVyO1xuXG4gICAgaWYgKGN1cnJlbnRSZXNpZGVudCBpbnN0YW5jZW9mIFNwYWNlckNvbXBvbmVudCkge1xuICAgICAgdGhpcy5ib290c3RyYXBTZXJ2aWNlLm1ha2VGdWxsV2lkdGgoZHJvcFRhcmdldC5tYWtlRnVsbFdpZHRoLmJpbmQoZHJvcFRhcmdldCkpO1xuICAgICAgaW5kZXhPZkRyb3AgPSB0aGlzLml0ZW1zXG4gICAgICAgIC5tYXAoeCA9PiB4LnNwYWNlcilcbiAgICAgICAgLmluZGV4T2YoY3VycmVudFJlc2lkZW50LnNwYWNlcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGluZGV4T2ZEcm9wID0gdGhpcy5pdGVtc1xuICAgICAgICAubWFwKHggPT4geC53aWRnZXQpXG4gICAgICAgIC5pbmRleE9mKGN1cnJlbnRSZXNpZGVudC53aWRnZXQpO1xuICAgICAgaWYgKHRoaXMuaXNXaWRnZXRNb3ZpbmdEb3duKG5ld1Jlc2lkZW50LndpZGdldCwgaW5kZXhPZkRyb3ApKSB7XG4gICAgICAgIGluZGV4T2ZEcm9wKys7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgaGVpZ2h0ID0gbmV3UmVzaWRlbnQuZ2V0SGVpZ2h0SW5mb3JtYXRpb24oKS5oZWlnaHQ7XG4gICAgdGhpcy5pdGVtcy5zcGxpY2UoaW5kZXhPZkRyb3AsIDAsIHsgZHJvcFRhcmdldDogZHJvcFRhcmdldCwgaGVpZ2h0OiBoZWlnaHQgfSk7XG4gIH1cblxuICBvbldpZGdldE1vdmUod2lkZ2V0Q29tcG9uZW50OiBXaWRnZXRDb21wb25lbnQpOiB2b2lkIHtcbiAgICB0aGlzLm1vdmluZ1dpZGdldENvbXBvbmVudCA9IHdpZGdldENvbXBvbmVudDtcbiAgICB0aGlzLnByZXZlbnRIaWdobGlnaHRpbmdXaGlsZU1vdmluZygpO1xuICAgIHRoaXMuaW5zZXJ0RHJvcFRhcmdldCh3aWRnZXRDb21wb25lbnQsIG51bGwpO1xuICB9XG5cbiAgb25XaWRnZXREcm9wcGVkKCk6IHZvaWQge1xuICAgIHRoaXMuaXRlbXMuc3BsaWNlKFxuICAgICAgdGhpcy5pdGVtcy5tYXAoeCA9PiB4LndpZGdldCkuaW5kZXhPZih0aGlzLm1vdmluZ1dpZGdldENvbXBvbmVudC53aWRnZXQpLFxuICAgICAgMSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLml0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAodGhpcy5pdGVtc1tpXS5kcm9wVGFyZ2V0KSB7XG4gICAgICAgIHRoaXMuaXRlbXMuc3BsaWNlKGksIDEsIHsgd2lkZ2V0OiB0aGlzLm1vdmluZ1dpZGdldENvbXBvbmVudC53aWRnZXQgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmFsbG93SGlnaGxpZ2h0aW5nKCk7XG4gICAgdGhpcy5tb3ZpbmdXaWRnZXRDb21wb25lbnQgPSBudWxsO1xuICAgIHRoaXMuYWRkSG9yaXpvbnRhbFNwYWNlcnMoKTtcbiAgfVxuXG4gIG9uV2lkZ2V0SG92ZXJlZCh3aWRnZXRDb21wb25lbnQ6IFdpZGdldENvbXBvbmVudCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5tb3ZpbmdXaWRnZXRDb21wb25lbnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc29sZS5sb2coJ3Rlc3QgMCcsIG5ldyBEYXRlKCkpO1xuICAgIHRoaXMubW92ZUhvdmVyU3Vic2NyaXB0aW9uID0gT2JzZXJ2YWJsZS5vZih7fSlcbiAgICAgIC5kZWxheSgzMClcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygndGVzdCcsIG5ldyBEYXRlKCkpO1xuICAgICAgICBpZiAoIXRoaXMubW92aW5nV2lkZ2V0Q29tcG9uZW50KSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5zZXJ0RHJvcFRhcmdldCh3aWRnZXRDb21wb25lbnQsIHRoaXMubW92aW5nV2lkZ2V0Q29tcG9uZW50KTtcbiAgICAgICAgdGhpcy5hZGRIb3Jpem9udGFsU3BhY2VycygpO1xuICAgICAgfSk7XG4gIH1cblxuICBvbldpZGdldFVuaG92ZXJlZCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5tb3ZlSG92ZXJTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMubW92ZUhvdmVyU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICB0aGlzLm1vdmVIb3ZlclN1YnNjcmlwdGlvbiA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgb25TcGFjZXJIb3ZlcmVkKHNwYWNlckNvbXBvbmVudDogU3BhY2VyQ29tcG9uZW50KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLm1vdmluZ1dpZGdldENvbXBvbmVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm1vdmVIb3ZlclN1YnNjcmlwdGlvbiA9IE9ic2VydmFibGUub2Yoe30pXG4gICAgICAuZGVsYXkoMzAwKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIGlmICghdGhpcy5tb3ZpbmdXaWRnZXRDb21wb25lbnQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbnNlcnREcm9wVGFyZ2V0KHNwYWNlckNvbXBvbmVudCwgdGhpcy5tb3ZpbmdXaWRnZXRDb21wb25lbnQpO1xuICAgICAgICB0aGlzLmFkZEhvcml6b250YWxTcGFjZXJzKCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIG9uU3BhY2VyVW5ob3ZlcmVkKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLm1vdmVIb3ZlclN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5tb3ZlSG92ZXJTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMubW92ZUhvdmVyU3Vic2NyaXB0aW9uID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG1ha2VHcmlkKCkge1xuICAgIGNvbnN0IGdyaWQgPSBbXTtcbiAgICBncmlkLnB1c2goW10pO1xuICAgIGxldCBjdXJyZW50Um93V2lkdGggPSAwO1xuICAgIGNvbnN0IHdpZGdldHMgPSB0aGlzLml0ZW1zXG4gICAgICAuZmlsdGVyKHggPT4geC53aWRnZXQpXG4gICAgICAubWFwKHggPT4geC53aWRnZXQpO1xuICBcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdpZGdldHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHdpZGdldCA9IHdpZGdldHNbaV07XG4gICAgICBjb25zdCB3aWR0aCA9IHRoaXMuYm9vdHN0cmFwU2VydmljZVxuICAgICAgICAuZ2V0V2lkdGgod2lkZ2V0LmdldEN1cnJlbnRXaWR0aC5iaW5kKHdpZGdldCkpO1xuICAgICAgZ3JpZFtncmlkLmxlbmd0aCAtIDFdLnB1c2god2lkZ2V0KTtcbiAgICAgIGN1cnJlbnRSb3dXaWR0aCArPSB3aWR0aDtcbiAgICAgIGNvbnN0IGlzTGFzdFdpZGdldCA9IGkgPT09IHdpZGdldHMubGVuZ3RoIC0gMTtcbiAgICAgIGlmIChpc0xhc3RXaWRnZXQpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZiAoY3VycmVudFJvd1dpZHRoID09PSB0aGlzLmJvb3RzdHJhcFNlcnZpY2UubWF4Q29sdW1ucykge1xuICAgICAgICBncmlkLnB1c2goW10pO1xuICAgICAgICBjdXJyZW50Um93V2lkdGggPSAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUHJldmlldyB0aGUgbmV4dCB3aWRnZXQgYW5kIHNlZSBpZiBhIG5ldyByb3cgaXMgbmVlZGVkIGR1ZSB0byBsYWNrIG9mIHNwYWNlLlxuICAgICAgICBjb25zdCBuZXh0V2lkZ2V0ID0gd2lkZ2V0c1tpICsgMV07XG4gICAgICAgIGNvbnN0IG5leHRXaWRnZXRXaWR0aCA9IHRoaXMuYm9vdHN0cmFwU2VydmljZVxuICAgICAgICAgIC5nZXRXaWR0aChuZXh0V2lkZ2V0LmdldEN1cnJlbnRXaWR0aC5iaW5kKG5leHRXaWRnZXQpKTtcbiAgICAgICAgY29uc3Qgc3BhY2VMZWZ0T25DdXJyZW50Um93ID0gdGhpcy5ib290c3RyYXBTZXJ2aWNlLm1heENvbHVtbnMgLSBjdXJyZW50Um93V2lkdGg7XG4gICAgICAgIGlmIChuZXh0V2lkZ2V0V2lkdGggPiBzcGFjZUxlZnRPbkN1cnJlbnRSb3cpIHtcbiAgICAgICAgICBncmlkLnB1c2goW10pO1xuICAgICAgICAgIGN1cnJlbnRSb3dXaWR0aCA9IDA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIFxuICAgIHJldHVybiBncmlkO1xuICB9O1xuXG4gIHByaXZhdGUgZmluZFJvd0NvbnRhaW5pbmdXaWRnZXQod2lkZ2V0OiBXaWRnZXQpOiBXaWRnZXRbXSB7XG4gICAgLy8gSSdtIG1ha2luZyBhIG11bHRpLWRpbWVuc2lvbmFsIGFycmF5IG9mIHRoZSBlbnRpcmUgZ3JpZCBiZWZvcmUgdHJ5aW5nIHRvXG4gICAgLy8gZmluZCB3aGljaCByb3cgdGhlIHdpZGdldCBpcyBpbi4gVGhpcyBpcyBsZXNzIGVmZmljaWVudCB0aGFuIGJ1aWxkaW5nIHRoZVxuICAgIC8vIGdyaWQgYW5kIHNpbXVsdGFuZW91c2x5IGNoZWNraW5nIGlmIHRoZSByb3cgaGFzIHRoZSB3aWRnZXQsIGJ1dCBpdCBtYWtlc1xuICAgIC8vIHRoZSBsb2dpYyBtdWNoIG1vcmUgcmVhc29uYWJsZS5cbiAgICBjb25zdCBncmlkID0gdGhpcy5tYWtlR3JpZCgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3JpZC5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qgd2lkZ2V0SW5kZXggPSBncmlkW2ldLmluZGV4T2Yod2lkZ2V0KTtcbiAgICAgIGlmICh3aWRnZXRJbmRleCA+PSAwKSB7XG4gICAgICAgIHJldHVybiBncmlkW2ldO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBwcml2YXRlIGNhbGN1bGF0ZUJvdW5kYXJpZXMod2lkZ2V0OiBXaWRnZXQpOiBvYmplY3Qge1xuICAgIGNvbnN0IHJvdyA9IHRoaXMuZmluZFJvd0NvbnRhaW5pbmdXaWRnZXQod2lkZ2V0KTtcbiAgICBjb25zb2xlLmxvZyhcInJvd1wiLCByb3cpO1xuICAgIGNvbnN0IGN1cnJlbnRQb3NpdGlvbiA9IHJvd1xuICAgICAgLnNsaWNlKDAsIHJvdy5pbmRleE9mKHdpZGdldCkgKyAxKVxuICAgICAgLm1hcCh4ID0+IHRoaXMuYm9vdHN0cmFwU2VydmljZS5nZXRXaWR0aCh4LmdldEN1cnJlbnRXaWR0aC5iaW5kKHgpKSlcbiAgICAgIC5yZWR1Y2UoKHgsIHkpID0+IHggKyB5KTtcbiAgICBjb25zdCBtaW5pbXVtV2lkdGggPSB0aGlzLmJvb3RzdHJhcFNlcnZpY2UuZ2V0V2lkdGgod2lkZ2V0LmdldE1pbmltdW1XaWR0aC5iaW5kKHdpZGdldCkpO1xuICAgIGNvbnN0IHNwYWNlVG9NaW5pbWl6ZSA9IHRoaXMuYm9vdHN0cmFwU2VydmljZS5nZXRXaWR0aCh3aWRnZXQuZ2V0Q3VycmVudFdpZHRoLmJpbmQod2lkZ2V0KSkgLSBtaW5pbXVtV2lkdGg7XG4gICAgXG4gICAgLy8gRG9uJ3QgZ28gbGVmdCBmYXIgZW5vdWdoIHRvIGV4Y2VlZCB0aGUgbWluaW11bSBvZiB0aGUgd2lkZ2V0LlxuICAgIGNvbnN0IGxlZnQgPSBjdXJyZW50UG9zaXRpb24gLSBzcGFjZVRvTWluaW1pemU7XG4gICAgLy8gRG9uJ3QgZ28gcmlnaHQgZmFyIGVub3VnaCB0byBleGNlZWQgdGhlIHdpZHRoIG9mIHRoZSByb3cuXG4gICAgY29uc3QgcmlnaHQgPSB0aGlzLmJvb3RzdHJhcFNlcnZpY2UubWF4Q29sdW1ucztcbiAgICAvLyBUaGlzIGlzIHVzZWQgdG8gZGV0ZXJtaW5lIGF0IHdoaWNoIGNvbHVtbiB0byBzdGFydCBkcmF3aW5nIGd1aWRlbGluZXMuXG4gICAgY29uc3Qgb2Zmc2V0ID0gbWluaW11bVdpZHRoIC0gbGVmdDtcbiAgICByZXR1cm4geyBsZWZ0LCByaWdodCwgb2Zmc2V0IH07XG4gIH1cblxuICBwcml2YXRlIGRyYXdSZXNpemVHdWlkZWxpbmVzKHdpZGdldENvbXBvbmVudDogV2lkZ2V0Q29tcG9uZW50KTogdm9pZCB7XG4gICAgY29uc3QgaGVpZ2h0SW5mb3JtYXRpb24gPSB3aWRnZXRDb21wb25lbnQuZ2V0SGVpZ2h0SW5mb3JtYXRpb24oKTtcbiAgICBjb25zdCBib3VuZGFyaWVzOiBhbnkgPSB0aGlzLmNhbGN1bGF0ZUJvdW5kYXJpZXMod2lkZ2V0Q29tcG9uZW50LndpZGdldCk7XG4gICAgZm9yIChsZXQgaSA9IGJvdW5kYXJpZXMubGVmdDsgaSA8PSBib3VuZGFyaWVzLnJpZ2h0OyBpKyspIHtcbiAgICAgIC8vIHVuc2hpZnQoKSB3aGljaCBpbnNlcnRzIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGFycmF5IGluc3RlYWQgb2YgcHVzaCgpXG4gICAgICAvLyBiZWNhdXNlIHdlIHdhbnQgdG8gZGlzcGxheSB0aGUgbG9uZ2VzdCBndWlkZWxpbmUgZmlyc3Qgc28gdGhhdCB0aGUgc2hvcnRlclxuICAgICAgLy8gb25lIGlzIG9uIHRvcCBvZiB0aGUgbG9uZ2VyIG9uZS4gVGhpcyB3aWxsIGhlbHAgd2hlbiB3ZSBob3ZlciBvdmVyIGVhY2ggb25lLlxuICAgICAgLy8gSWYgdGhlIGxvbmdlciBvbmUgd2FzIG9uIHRvcCBpdCB3b3VsZCBiZSB0aGUgb25seSBndWlkZWxpbmUgcmFpc2luZyBldmVudHMuXG4gICAgICB0aGlzLnJlc2l6ZUd1aWRlbGluZXMudW5zaGlmdCh7XG4gICAgICAgIHdpZHRoT2ZHdWlkZWxpbmU6IGksXG4gICAgICAgIHRhcmdldFdpZHRoT2ZXaWRnZXQ6IGkgKyBib3VuZGFyaWVzLm9mZnNldCxcbiAgICAgICAgdG9wOiBoZWlnaHRJbmZvcm1hdGlvbi50b3AsXG4gICAgICAgIGhlaWdodDogaGVpZ2h0SW5mb3JtYXRpb24uaGVpZ2h0LFxuICAgICAgICB3aWRnZXQ6IHdpZGdldENvbXBvbmVudC53aWRnZXRcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIG9uV2lkZ2V0UmVzaXplZCh3aWRnZXQ6IFdpZGdldCk6IHZvaWQge1xuICAgIGNvbnN0IGluZGV4T2ZXaWRnZXQgPSB0aGlzLml0ZW1zXG4gICAgICAubWFwKHggPT4geC53aWRnZXQpXG4gICAgICAuaW5kZXhPZih3aWRnZXQpO1xuICAgIHRoaXMuaXRlbXMuc3BsaWNlKGluZGV4T2ZXaWRnZXQsIDEsIHsgd2lkZ2V0IH0pO1xuICAgIHRoaXMuYWRkSG9yaXpvbnRhbFNwYWNlcnMoKTtcbiAgfVxuXG4gIHByaXZhdGUgZW5kV2lkZ2V0UmVzaXplKCkge1xuICAgIHRoaXMucmVzaXplR3VpZGVsaW5lcyA9IFtdO1xuICAgIHRoaXMuYWxsb3dIaWdobGlnaHRpbmcoKTtcbiAgICBpZiAodGhpcy5tb3VzZVVwU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLm1vdXNlVXBTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMudG91Y2hFbmRTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMudG91Y2hFbmRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICBvbldpZGdldFJlc2l6ZVN0YXJ0ZWQod2lkZ2V0Q29tcG9uZW50KTogdm9pZCB7XG4gICAgdGhpcy5kcmF3UmVzaXplR3VpZGVsaW5lcyh3aWRnZXRDb21wb25lbnQpO1xuICAgIHRoaXMucHJldmVudEhpZ2hsaWdodGluZ1doaWxlTW92aW5nKCk7XG4gICAgdGhpcy5tb3VzZVVwU3Vic2NyaXB0aW9uID1cbiAgICAgIE9ic2VydmFibGUuZnJvbUV2ZW50KHRoaXMuZG9jdW1lbnQsICdtb3VzZXVwJylcbiAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5lbmRXaWRnZXRSZXNpemUoKTtcbiAgICAgICAgICBpZiAodGhpcy5tb3VzZVVwU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLm1vdXNlVXBTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIHRoaXMudG91Y2hFbmRTdWJzY3JpcHRpb24gPVxuICAgICAgT2JzZXJ2YWJsZS5mcm9tRXZlbnQodGhpcy5kb2N1bWVudCwgJ3RvdWNoZW5kJylcbiAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5lbmRXaWRnZXRSZXNpemUoKTtcbiAgICAgICAgICBpZiAodGhpcy50b3VjaEVuZFN1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy50b3VjaEVuZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gIH1cblxuICBvblJlbmRlcldpZGdldCh3aWRnZXQ6IFdpZGdldCkge1xuICAgIHRoaXMuaXRlbXMudW5zaGlmdCh7IHdpZGdldCB9KTtcbiAgICB0aGlzLmFkZEhvcml6b250YWxTcGFjZXJzKCk7XG4gIH1cblxuICBvbkRlcmVuZGVyV2lkZ2V0KHdpZGdldDogV2lkZ2V0KSB7XG4gICAgdGhpcy5pdGVtc1xuICAgICAgLmZpbHRlcih4ID0+IHgud2lkZ2V0ICYmIHgud2lkZ2V0LmlkID09PSB3aWRnZXQuaWQpXG4gICAgICAuZm9yRWFjaCh4ID0+IHtcbiAgICAgICAgdGhpcy5pdGVtcy5zcGxpY2UodGhpcy5pdGVtcy5pbmRleE9mKHgpLCAxKTtcbiAgICAgIH0pO1xuICAgIHRoaXMuYWRkSG9yaXpvbnRhbFNwYWNlcnMoKTtcbiAgfVxuXG4gIG9uRWRpdExheW91dChldmVudCkge1xuICAgIHRoaXMubGF5b3V0RWRpdG9yLmVkaXQoZXZlbnQucGFnZVgsIGV2ZW50LnBhZ2VZKTtcbiAgICB0aGlzLnRvZ2dsZU92ZXJsYXkoKTtcbiAgfVxuXG4gIG9uSGlkZUxheW91dEVkaXRvcigpIHtcbiAgICB0aGlzLmxheW91dEVkaXRvci5oaWRlKCk7XG4gICAgdGhpcy50b2dnbGVPdmVybGF5KCk7XG4gIH1cblxuICBvbldpZGdldENsb3NlQ2xpY2sod2lkZ2V0KSB7XG4gICAgdGhpcy5pdGVtc1xuICAgICAgLmZpbHRlcih4ID0+IHgud2lkZ2V0ICYmIHgud2lkZ2V0ID09PSB3aWRnZXQpXG4gICAgICAuZm9yRWFjaCh4ID0+IHtcbiAgICAgICAgdGhpcy5pdGVtcy5zcGxpY2UodGhpcy5pdGVtcy5pbmRleE9mKHgpLCAxKTtcbiAgICAgIH0pO1xuICAgIHRoaXMuYWRkSG9yaXpvbnRhbFNwYWNlcnMoKTtcbiAgfVxuXG4gIG9uV2lkZ2V0VG9nZ2xlRnVsbFNjcmVlbkNsaWNrKCkge1xuICAgIHRoaXMudG9nZ2xlT3ZlcmxheSgpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgaWYgKHRoaXMubW92ZUhvdmVyU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLm1vdmVIb3ZlclN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5tb3VzZVVwU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLm1vdXNlVXBTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMudG91Y2hFbmRTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMudG91Y2hFbmRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==